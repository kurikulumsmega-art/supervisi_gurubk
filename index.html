<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisi Guru BK - SMKN 1 Purbalingga</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-btn.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .table-view {
            width: 100%;
            border-collapse: collapse;
        }
        .table-view th, .table-view td {
            border: 1px solid #e2e8f0;
            padding: 12px 16px;
            text-align: left;
            vertical-align: top;
        }
        .table-view th {
            background-color: #3b82f6;
            color: white;
            font-weight: 600;
        }
        .table-view tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .category-row {
            background-color: #e0f2fe !important;
            font-weight: 600;
            color: #0c4a6e;
        }
        .subcategory-row {
            background-color: #f0f9ff !important;
            font-weight: 500;
            color: #0369a1;
        }
        .required-field::after {
            content: " *";
            color: #ef4444;
        }
        .radio-group-horizontal {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .radio-option-horizontal {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .score-radio-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .score-radio-option {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        /* Print Styles - Updated */
        @media print {
            body {
                font-size: 12pt;
                line-height: 1.3;
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .container {
                max-width: 100%;
                margin: 0;
                padding: 10px;
            }
            .bg-white {
                background-color: white !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }
            .tab-content {
                display: block !important;
                page-break-before: always;
            }
            .tab-content:first-child {
                page-break-before: auto;
            }
            .table-view {
                page-break-inside: auto;
            }
            .table-view tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            .table-view td, .table-view th {
                padding: 6px 8px;
            }
            .action-buttons {
                display: none !important;
            }
            .signature-section {
                margin-top: 30px;
                page-break-inside: avoid;
            }
            @page {
                margin: 1.5cm;
                size: A4;
            }
            /* Show all tabs when printing */
            #tab-rpl-content, #tab-pelaksanaan-content, #tab-administrasi-content {
                display: block !important;
            }
            .tab-nav {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4">
        <!-- Header -->
        <header class="text-center mb-8 bg-white p-6 rounded-xl shadow-sm">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-600">SUPERVISI GURU BK TERPADU</h1>
            <p class="text-lg md:text-xl font-semibold text-gray-700">SMK Negeri 1 Purbalingga</p>
            <p class="text-sm text-gray-600 mt-2">RPL BK • Pelaksanaan Layanan • Administrasi BK</p>
        </header>

        <!-- Informasi Supervisi (Pindah ke Atas) -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Supervisi</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="tahun_pelajaran" class="block text-sm font-medium text-gray-600 required-field">Tahun Pelajaran</label>
                    <input type="text" id="tahun_pelajaran" value="2025/2026" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="semester" class="block text-sm font-medium text-gray-600 required-field">Semester</label>
                    <select id="semester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        <option value="Ganjil">Ganjil</option>
                        <option value="Genap">Genap</option>
                    </select>
                </div>
                <div>
                    <label for="kelas" class="block text-sm font-medium text-gray-600 required-field">Kelas</label>
                    <input type="text" id="kelas" placeholder="Contoh: XI RPL 1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="tanggal_supervisi" class="block text-sm font-medium text-gray-600 required-field">Tanggal Supervisi</label>
                    <input type="date" id="tanggal_supervisi" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>

        <!-- Informasi Personal (Urutan Diubah) -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Personal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Guru BK (Kiri) -->
                <div>
                    <h3 class="text-lg font-semibold text-green-600 mb-3">Guru BK</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_guru" class="block text-sm font-medium text-gray-600 required-field">Nama Guru BK</label>
                            <input type="text" id="nama_guru" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="nip" class="block text-sm font-medium text-gray-600 required-field">NIP Guru BK</label>
                            <input type="text" id="nip" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>
                
                <!-- Supervisor (Kanan) -->
                <div>
                    <h3 class="text-lg font-semibold text-blue-600 mb-3">Supervisor</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_supervisor" class="block text-sm font-medium text-gray-600 required-field">Nama Supervisor</label>
                            <input type="text" id="nama_supervisor" value="Maryono, S.Pd., M.Si" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="nip_supervisor" class="block text-sm font-medium text-gray-600 required-field">NIP Supervisor</label>
                            <input type="text" id="nip_supervisor" value="196607012000121002" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 flex justify-center border-b border-gray-300 tab-nav">
            <button id="tab-rpl-btn" class="tab-btn py-3 px-6 border-b-2 border-transparent" onclick="switchTab('rpl')">RPL BK</button>
            <button id="tab-pelaksanaan-btn" class="tab-btn py-3 px-6 border-b-2 border-transparent" onclick="switchTab('pelaksanaan')">Pelaksanaan Layanan</button>
            <button id="tab-administrasi-btn" class="tab-btn active py-3 px-6 border-b-2 border-blue-500 text-blue-600" onclick="switchTab('administrasi')">Administrasi BK</button>
        </div>

        <!-- ========== TAB RPL ========== -->
        <div id="tab-rpl-content" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Instrumen Pemantauan dan Supervisi RPL Bimbingan Konseling</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="45%">Komponen Rencana Pelaksanaan Pembelajaran</th>
                                <th width="25%">Hasil Penelaahan dan Skor</th>
                                <th width="25%">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-rpl-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_rpl" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_rpl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_rpl" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_rpl" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TAB PELAKSANAAN ========== -->
        <div id="tab-pelaksanaan-content" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Instrumen Pemantauan dan Supervisi Pelaksanaan Layanan Bimbingan Konseling</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="45%">Aspek yang Diamati</th>
                                <th width="25%">Penilaian</th>
                                <th width="25%">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-pelaksanaan-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_pelaksanaan" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_pelaksanaan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_pelaksanaan" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_pelaksanaan" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TAB ADMINISTRASI ========== -->
        <div id="tab-administrasi-content" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Supervisi Administrasi Guru BK</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="55%">Komponen Administrasi</th>
                                <th width="20%">Penilaian</th>
                                <th width="20%">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-administrasi-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_admin" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_admin" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_admin" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_admin" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="bg-white p-6 rounded-xl shadow-sm mt-6 action-buttons">
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="validateAndCalculate()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-calculator mr-2"></i>Hitung Skor & Simpan
                </button>
                <button onclick="saveToSpreadsheet()" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-cloud-upload-alt mr-2"></i>Simpan ke Spreadsheet
                </button>
                <button onclick="viewSavedData()" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-database mr-2"></i>Lihat Data Tersimpan
                </button>
                <button onclick="exportToCSV()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700">
                    <i class="fas fa-file-csv mr-2"></i>Export ke CSV
                </button>
                <button onclick="printAllTabs()" class="bg-orange-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-700">
                    <i class="fas fa-print mr-2"></i>Cetak Semua Form
                </button>
                <button onclick="resetForm()" class="bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700">
                    <i class="fas fa-redo mr-2"></i>Reset Form
                </button>
            </div>
        </div>

        <!-- Hasil Penilaian -->
        <div id="hasil-penilaian" class="bg-white p-6 rounded-xl shadow-sm mt-6 hidden">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Hasil Penilaian</h3>
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-sm text-gray-600">Skor Total</p>
                        <p class="text-2xl font-bold text-blue-700" id="skor_total">0</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Skor Maksimal</p>
                        <p class="text-2xl font-bold text-blue-700" id="skor_maksimal">0</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Nilai Akhir</p>
                        <p class="text-2xl font-bold text-blue-700" id="nilai_akhir">0%</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Peringkat</p>
                        <p class="text-2xl font-bold text-blue-700" id="keterangan_nilai">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tanda Tangan -->
        <section class="bg-white p-6 rounded-xl shadow-sm mt-6 signature-section">
            <h2 class="text-xl font-bold text-indigo-700 mb-6">VALIDASI</h2>
            
            <div class="text-center mb-6">
                <label class="text-sm font-medium text-gray-700 mr-2">Purbalingga,</label>
                <input type="date" id="signatureDate" class="p-2 border border-gray-300 rounded-lg">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Supervisor -->
                <div class="text-center">
                    <p class="font-semibold text-gray-700">Supervisor</p>
                    <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center">
                        <span class="text-gray-400 text-sm">Tanda Tangan</span>
                    </div>
                    <p class="font-bold text-gray-800 mt-2" id="supervisorNameDisplay">........................................</p>
                    <p class="text-xs text-gray-500" id="supervisorNipDisplay">NIP. .............................</p>
                </div>
                
                <!-- Guru BK -->
                <div class="text-center">
                    <p class="font-semibold text-gray-700">Guru BK</p>
                    <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center">
                        <span class="text-gray-400 text-sm">Tanda Tangan</span>
                    </div>
                    <p class="font-bold text-gray-800 mt-2" id="teacherNameDisplay">........................................</p>
                    <p class="text-xs text-gray-500" id="teacherNipDisplay">NIP. .............................</p>
                </div>
            </div>
            
            <div class="text-center pt-6 border-t border-dashed">
                <p class="font-semibold text-gray-700">Mengetahui, Kepala Sekolah</p>
                <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center mx-auto" style="max-width: 300px;">
                    <span class="text-gray-400 text-sm">Tanda Tangan</span>
                </div>
                <p class="font-bold text-gray-800 mt-2">Maryono S.Pd, M.Si</p>
                <p class="text-xs text-gray-500">NIP. 19660701 2000121002</p>
            </div>
        </section>
    </div>

    <!-- Modal untuk menampilkan data tersimpan -->
    <div id="dataModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Data Supervisi Tersimpan</h3>
                    <button onclick="closeDataModal()" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-2 px-7 py-3">
                    <div class="mb-4">
                        <label for="filterTab" class="block text-sm font-medium text-gray-700 mb-2">Filter berdasarkan tipe supervisi:</label>
                        <select id="filterTab" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="filterData()">
                            <option value="all">Semua</option>
                            <option value="rpl">RPL BK</option>
                            <option value="pelaksanaan">Pelaksanaan Layanan</option>
                            <option value="administrasi">Administrasi BK</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipe</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru BK</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nilai</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="savedDataContainer" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                    <div id="noDataMessage" class="text-center py-4 text-gray-500 hidden">
                        Tidak ada data tersimpan
                    </div>
                </div>
                <div class="items-center px-4 py-3 border-t border-gray-200 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button onclick="closeDataModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Element -->
    <div id="notification" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center gap-3">
            <span id="notificationText"></span>
            <div id="notificationSpinner" class="hidden">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            </div>
        </div>
    </div>

    <script>
        // ========== DATA INSTRUMEN RPL ==========
        const instrumenRPL = [
            { kategori: 'A. Identitas', komponen: 'Terdapat : komponen bimbingan, bidang layanan, topik/tema layanan/rumusan masalah, kelas, semester, alokasi waktu Layanan Bimbingan Konseling', id: 'rpl_1' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian dengan topik/tema layanan bimbingan', id: 'rpl_2' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian penggunaan kata kerja operasional dengan kompetensi yang diukur', id: 'rpl_3' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian dengan aspek pengetahuan, sikap, dan keterampilan.', id: 'rpl_4' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan kebutuhan / masalah peserta didik.', id: 'rpl_5' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan tujuan layanan bimbingan', id: 'rpl_6' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_7' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan alokasi waktu', id: 'rpl_8' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan kebutuhan / masalah peserta didik', id: 'rpl_9' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan Tujuan layanan BK', id: 'rpl_10' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_11' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan tujuan layanan BK', id: 'rpl_12' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan topik / materi / masalah layanan BK', id: 'rpl_13' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_14' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian kegiatan pendahuluan/pendekatan, inti, dan penutup dengan tahapan layanan BK.', id: 'rpl_15' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian layanan dengan pendekatan/Teknik layanan BK', id: 'rpl_16' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian penyajian/kajian/pembahasan topik/tema/masalah dengan sistematika Layanan BK', id: 'rpl_17' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian waktu pelaksanaan layanan BK dengan cakupan topik/tema/masalah peserta didik.', id: 'rpl_18' },
            { kategori: 'G. Penilaian', komponen: 'Kesesuaian dengan teknik penilaian proses dan hasil layanan BK', id: 'rpl_19' },
            { kategori: 'G. Penilaian', komponen: 'Kesesuaian dengan dengan tujuan layanan BK', id: 'rpl_20' }
        ];

        // ========== DATA INSTRUMEN PELAKSANAAN ==========
        const instrumenPelaksanaan = [
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Guru BK menyapa dengan kalimat yang membuat siswa bersemangat (menanyakan kabar, kondisi siswa)', id: 'pelaksanaan_1' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Mengajak siswa untuk melakukan permainan atau ice breaking.', id: 'pelaksanaan_2' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Menanyakan kesiapan siswa mengikuti kegiatan layanan.', id: 'pelaksanaan_3' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan topik layanan bk', id: 'pelaksanaan_4' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan tujuan layanan BK yang akan dicapai peserta didik.', id: 'pelaksanaan_5' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan rencana kegiatan layanan dan batasan waktu kegiatan.', id: 'pelaksanaan_6' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Kemampuan menyesuaikan materi dengan tujuan Layanan BK.', id: 'pelaksanaan_7' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Kemampuan mengkaitkan materi dengan pengetahuan lain yang relevan, perkembangan Iptek, dan kehidupan nyata.', id: 'pelaksanaan_8' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Menyajikan pembahasan materi Layanan BK dengan tepat.', id: 'pelaksanaan_9' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Menyajikan materi secara sistematis (mudah ke sulit, dari konkrit ke abstrak)', id: 'pelaksanaan_10' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK sesuai dengan kompetensi yang akan dicapai.', id: 'pelaksanaan_11' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Menfasilitasi kegiatan yang memuat komponen eksplorasi, elaborasi dan konfirmasi.', id: 'pelaksanaan_12' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK secara runtut.', id: 'pelaksanaan_13' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Menguasai kelas/kelompok layanan BK', id: 'pelaksanaan_14' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK yang bersifat kontekstual.', id: 'pelaksanaan_15' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK yang memungkinkan tumbuhnya kebiasaan positif (nurturant effect).', id: 'pelaksanaan_16' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK sesuai dengan alokasi waktu yang direncanakan.', id: 'pelaksanaan_17' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menunjukkan keterampilan dalam penggunaan sumber Layanan BK.', id: 'pelaksanaan_18' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menunjukkan keterampilan dalam penggunaan media Layanan BK.', id: 'pelaksanaan_19' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menghasilkan pesan yang menarik.', id: 'pelaksanaan_20' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Melibatkan peserta didik dalam pemanfaatan sumber Layanan BK.', id: 'pelaksanaan_21' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Melibatkan peserta didik dalam pemanfaatan media Layanan BK.', id: 'pelaksanaan_22' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menumbuhkan partisipasi aktif peserta didik.', id: 'pelaksanaan_23' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Merespon positif partisipasi peserta didik.', id: 'pelaksanaan_24' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menunjukkan sikap terbuka terhadap respons peserta didik.', id: 'pelaksanaan_25' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menunjukkan hubungan antar pribadi yang kondusif.', id: 'pelaksanaan_26' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menumbuhkan keceriaan atau antusiasme peserta didik.', id: 'pelaksanaan_27' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penggunaan Bahasa yang Benar dan Tepat dalam Layanan BK', komponen: 'Menggunakan bahasa lisan secara jelas dan lancar.', id: 'pelaksanaan_28' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penggunaan Bahasa yang Benar dan Tepat dalam Layanan BK', komponen: 'Menggunakan bahasa tulis yang baik dan benar.', id: 'pelaksanaan_29' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Melakukan refleksi atau membuat rangkuman dengan melibatkan peserta didik.', id: 'pelaksanaan_30' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Memberikan tes lisan atau tetulis.', id: 'pelaksanaan_31' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Melaksanakan tindak lanjut dengan memberikan arahan kegiatan berikutnya.', id: 'pelaksanaan_32' }
        ];

        // ========== DATA INSTRUMEN ADMINISTRASI ==========
        const instrumenAdministrasi = [
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Angket Kebutuhan Peserta Didik', id: 'admin_1' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Data Analisis Kebutuhan Siswa', id: 'admin_2' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Program Layanan BK', id: 'admin_3' },
            { kategori: 'Dokumen Wajib', komponen: 'Kalender Pendidikan dan analisis minggu efektif', id: 'admin_4' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Jadwal Layanan BK', id: 'admin_5' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Standar Kompetensi Kemandirian Peserta Didik.', id: 'admin_6' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Rencana Persiapan Layanan (RPL)', id: 'admin_7' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Kumpulan Materi Layanan BK', id: 'admin_8' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Catatan Kasus', id: 'admin_9' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Agenda Guru / Jurnal Layanan Bimbingan', id: 'admin_10' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Catatan Konseling', id: 'admin_11' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Home Visit', id: 'admin_12' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Kegiatan Konferensi Kasus', id: 'admin_13' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Evaluasi Layanan BK', id: 'admin_14' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki dokumen tindak lanjut layanan BK', id: 'admin_15' },
            { kategori: 'Dokumen Penunjang', komponen: 'Memiliki daftar hadir peserta didik', id: 'admin_16' },
            { kategori: 'Dokumen Penunjang', komponen: 'Melakukan Pengembangan Keprofesian Berkelanjutan', id: 'admin_17' }
        ];

        let currentTab = 'administrasi';
        let savedData = [];

        // ========== URL WEB APP ANDA ==========
        // Ganti dengan URL Web App Anda yang benar
        const SPREADSHEET_URL = '<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisi Guru BK - SMKN 1 Purbalingga</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-btn.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .table-view {
            width: 100%;
            border-collapse: collapse;
        }
        .table-view th, .table-view td {
            border: 1px solid #e2e8f0;
            padding: 12px 16px;
            text-align: left;
            vertical-align: top;
        }
        .table-view th {
            background-color: #3b82f6;
            color: white;
            font-weight: 600;
        }
        .table-view tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .category-row {
            background-color: #e0f2fe !important;
            font-weight: 600;
            color: #0c4a6e;
        }
        .subcategory-row {
            background-color: #f0f9ff !important;
            font-weight: 500;
            color: #0369a1;
        }
        .required-field::after {
            content: " *";
            color: #ef4444;
        }
        .radio-group-horizontal {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .radio-option-horizontal {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .score-radio-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .score-radio-option {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        /* Print Styles - Updated */
        @media print {
            body {
                font-size: 12pt;
                line-height: 1.3;
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .container {
                max-width: 100%;
                margin: 0;
                padding: 10px;
            }
            .bg-white {
                background-color: white !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }
            .tab-content {
                display: block !important;
                page-break-before: always;
            }
            .tab-content:first-child {
                page-break-before: auto;
            }
            .table-view {
                page-break-inside: auto;
            }
            .table-view tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            .table-view td, .table-view th {
                padding: 6px 8px;
            }
            .action-buttons {
                display: none !important;
            }
            .signature-section {
                margin-top: 30px;
                page-break-inside: avoid;
            }
            @page {
                margin: 1.5cm;
                size: A4;
            }
            /* Show all tabs when printing */
            #tab-rpl-content, #tab-pelaksanaan-content, #tab-administrasi-content {
                display: block !important;
            }
            .tab-nav {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4">
        <!-- Header -->
        <header class="text-center mb-8 bg-white p-6 rounded-xl shadow-sm">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-600">SUPERVISI GURU BK TERPADU</h1>
            <p class="text-lg md:text-xl font-semibold text-gray-700">SMK Negeri 1 Purbalingga</p>
            <p class="text-sm text-gray-600 mt-2">RPL BK • Pelaksanaan Layanan • Administrasi BK</p>
        </header>

        <!-- Informasi Supervisi (Pindah ke Atas) -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Supervisi</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="tahun_pelajaran" class="block text-sm font-medium text-gray-600 required-field">Tahun Pelajaran</label>
                    <input type="text" id="tahun_pelajaran" value="2025/2026" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="semester" class="block text-sm font-medium text-gray-600 required-field">Semester</label>
                    <select id="semester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        <option value="Ganjil">Ganjil</option>
                        <option value="Genap">Genap</option>
                    </select>
                </div>
                <div>
                    <label for="kelas" class="block text-sm font-medium text-gray-600 required-field">Kelas</label>
                    <input type="text" id="kelas" placeholder="Contoh: XI RPL 1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="tanggal_supervisi" class="block text-sm font-medium text-gray-600 required-field">Tanggal Supervisi</label>
                    <input type="date" id="tanggal_supervisi" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>

        <!-- Informasi Personal (Urutan Diubah) -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Personal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Guru BK (Kiri) -->
                <div>
                    <h3 class="text-lg font-semibold text-green-600 mb-3">Guru BK</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_guru" class="block text-sm font-medium text-gray-600 required-field">Nama Guru BK</label>
                            <input type="text" id="nama_guru" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="nip" class="block text-sm font-medium text-gray-600 required-field">NIP Guru BK</label>
                            <input type="text" id="nip" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>
                
                <!-- Supervisor (Kanan) -->
                <div>
                    <h3 class="text-lg font-semibold text-blue-600 mb-3">Supervisor</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_supervisor" class="block text-sm font-medium text-gray-600 required-field">Nama Supervisor</label>
                            <input type="text" id="nama_supervisor" value="Maryono, S.Pd., M.Si" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="nip_supervisor" class="block text-sm font-medium text-gray-600 required-field">NIP Supervisor</label>
                            <input type="text" id="nip_supervisor" value="196607012000121002" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 flex justify-center border-b border-gray-300 tab-nav">
            <button id="tab-rpl-btn" class="tab-btn py-3 px-6 border-b-2 border-transparent" onclick="switchTab('rpl')">RPL BK</button>
            <button id="tab-pelaksanaan-btn" class="tab-btn py-3 px-6 border-b-2 border-transparent" onclick="switchTab('pelaksanaan')">Pelaksanaan Layanan</button>
            <button id="tab-administrasi-btn" class="tab-btn active py-3 px-6 border-b-2 border-blue-500 text-blue-600" onclick="switchTab('administrasi')">Administrasi BK</button>
        </div>

        <!-- ========== TAB RPL ========== -->
        <div id="tab-rpl-content" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Instrumen Pemantauan dan Supervisi RPL Bimbingan Konseling</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="45%">Komponen Rencana Pelaksanaan Pembelajaran</th>
                                <th width="25%">Hasil Penelaahan dan Skor</th>
                                <th width="25%">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-rpl-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_rpl" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_rpl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_rpl" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_rpl" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TAB PELAKSANAAN ========== -->
        <div id="tab-pelaksanaan-content" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Instrumen Pemantauan dan Supervisi Pelaksanaan Layanan Bimbingan Konseling</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="45%">Aspek yang Diamati</th>
                                <th width="25%">Penilaian</th>
                                <th width="25%">Catatan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-pelaksanaan-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_pelaksanaan" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_pelaksanaan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_pelaksanaan" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_pelaksanaan" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TAB ADMINISTRASI ========== -->
        <div id="tab-administrasi-content" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-bold">Supervisi Administrasi Guru BK</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th width="5%">No</th>
                                <th width="55%">Komponen Administrasi</th>
                                <th width="20%">Penilaian</th>
                                <th width="20%">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="instrumen-administrasi-container">
                            <!-- Diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Jenis Layanan (Dipindah ke sini) -->
                <div class="p-6 space-y-4">
                    <div>
                        <label for="jenis_layanan_admin" class="block text-sm font-medium text-gray-600 required-field">Jenis Layanan</label>
                        <select id="jenis_layanan_admin" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            <option value="">Pilih Jenis Layanan</option>
                            <option value="Layanan Informasi">Layanan Informasi</option>
                            <option value="Layanan Bimbingan Kelompok">Layanan Bimbingan Kelompok</option>
                            <option value="Layanan Konseling Perorangan">Layanan Konseling Perorangan</option>
                            <option value="Layanan Konseling Kelompok">Layanan Konseling Kelompok</option>
                            <option value="Layanan Penempatan dan Penyaluran">Layanan Penempatan dan Penyaluran</option>
                            <option value="Layanan Penguatan">Layanan Penguatan</option>
                        </select>
                    </div>
                    <div>
                        <label for="komentar_admin" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                        <textarea id="komentar_admin" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="bg-white p-6 rounded-xl shadow-sm mt-6 action-buttons">
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="validateAndCalculate()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-calculator mr-2"></i>Hitung Skor & Simpan
                </button>
                <button onclick="saveToSpreadsheet()" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-cloud-upload-alt mr-2"></i>Simpan ke Spreadsheet
                </button>
                <button onclick="viewSavedData()" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-database mr-2"></i>Lihat Data Tersimpan
                </button>
                <button onclick="exportToCSV()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700">
                    <i class="fas fa-file-csv mr-2"></i>Export ke CSV
                </button>
                <button onclick="printAllTabs()" class="bg-orange-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-700">
                    <i class="fas fa-print mr-2"></i>Cetak Semua Form
                </button>
                <button onclick="resetForm()" class="bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700">
                    <i class="fas fa-redo mr-2"></i>Reset Form
                </button>
            </div>
        </div>

        <!-- Hasil Penilaian -->
        <div id="hasil-penilaian" class="bg-white p-6 rounded-xl shadow-sm mt-6 hidden">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Hasil Penilaian</h3>
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-sm text-gray-600">Skor Total</p>
                        <p class="text-2xl font-bold text-blue-700" id="skor_total">0</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Skor Maksimal</p>
                        <p class="text-2xl font-bold text-blue-700" id="skor_maksimal">0</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Nilai Akhir</p>
                        <p class="text-2xl font-bold text-blue-700" id="nilai_akhir">0%</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Peringkat</p>
                        <p class="text-2xl font-bold text-blue-700" id="keterangan_nilai">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tanda Tangan -->
        <section class="bg-white p-6 rounded-xl shadow-sm mt-6 signature-section">
            <h2 class="text-xl font-bold text-indigo-700 mb-6">VALIDASI</h2>
            
            <div class="text-center mb-6">
                <label class="text-sm font-medium text-gray-700 mr-2">Purbalingga,</label>
                <input type="date" id="signatureDate" class="p-2 border border-gray-300 rounded-lg">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Supervisor -->
                <div class="text-center">
                    <p class="font-semibold text-gray-700">Supervisor</p>
                    <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center">
                        <span class="text-gray-400 text-sm">Tanda Tangan</span>
                    </div>
                    <p class="font-bold text-gray-800 mt-2" id="supervisorNameDisplay">........................................</p>
                    <p class="text-xs text-gray-500" id="supervisorNipDisplay">NIP. .............................</p>
                </div>
                
                <!-- Guru BK -->
                <div class="text-center">
                    <p class="font-semibold text-gray-700">Guru BK</p>
                    <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center">
                        <span class="text-gray-400 text-sm">Tanda Tangan</span>
                    </div>
                    <p class="font-bold text-gray-800 mt-2" id="teacherNameDisplay">........................................</p>
                    <p class="text-xs text-gray-500" id="teacherNipDisplay">NIP. .............................</p>
                </div>
            </div>
            
            <div class="text-center pt-6 border-t border-dashed">
                <p class="font-semibold text-gray-700">Mengetahui, Kepala Sekolah</p>
                <div class="border border-gray-300 h-24 mt-2 rounded flex items-center justify-center mx-auto" style="max-width: 300px;">
                    <span class="text-gray-400 text-sm">Tanda Tangan</span>
                </div>
                <p class="font-bold text-gray-800 mt-2">Maryono S.Pd, M.Si</p>
                <p class="text-xs text-gray-500">NIP. 19660701 2000121002</p>
            </div>
        </section>
    </div>

    <!-- Modal untuk menampilkan data tersimpan -->
    <div id="dataModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Data Supervisi Tersimpan</h3>
                    <button onclick="closeDataModal()" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-2 px-7 py-3">
                    <div class="mb-4">
                        <label for="filterTab" class="block text-sm font-medium text-gray-700 mb-2">Filter berdasarkan tipe supervisi:</label>
                        <select id="filterTab" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="filterData()">
                            <option value="all">Semua</option>
                            <option value="rpl">RPL BK</option>
                            <option value="pelaksanaan">Pelaksanaan Layanan</option>
                            <option value="administrasi">Administrasi BK</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipe</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru BK</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nilai</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="savedDataContainer" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                    <div id="noDataMessage" class="text-center py-4 text-gray-500 hidden">
                        Tidak ada data tersimpan
                    </div>
                </div>
                <div class="items-center px-4 py-3 border-t border-gray-200 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button onclick="closeDataModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Element -->
    <div id="notification" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 hidden">
        <div class="flex items-center gap-3">
            <span id="notificationText"></span>
            <div id="notificationSpinner" class="hidden">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
            </div>
        </div>
    </div>

    <script>
        // ========== DATA INSTRUMEN RPL ==========
        const instrumenRPL = [
            { kategori: 'A. Identitas', komponen: 'Terdapat : komponen bimbingan, bidang layanan, topik/tema layanan/rumusan masalah, kelas, semester, alokasi waktu Layanan Bimbingan Konseling', id: 'rpl_1' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian dengan topik/tema layanan bimbingan', id: 'rpl_2' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian penggunaan kata kerja operasional dengan kompetensi yang diukur', id: 'rpl_3' },
            { kategori: 'B. Perumusan Tujuan Layanan Bimbingan', komponen: 'Kesesuaian dengan aspek pengetahuan, sikap, dan keterampilan.', id: 'rpl_4' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan kebutuhan / masalah peserta didik.', id: 'rpl_5' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan tujuan layanan bimbingan', id: 'rpl_6' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_7' },
            { kategori: 'C. Pemilihan topik/Materi Layanan', komponen: 'Kesesuaian dengan alokasi waktu', id: 'rpl_8' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan kebutuhan / masalah peserta didik', id: 'rpl_9' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan Tujuan layanan BK', id: 'rpl_10' },
            { kategori: 'D. Pemilihan Metode /Teknik Layanan BK', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_11' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan tujuan layanan BK', id: 'rpl_12' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan topik / materi / masalah layanan BK', id: 'rpl_13' },
            { kategori: 'E. Pemilihan Alat / Media Layanan BK.', komponen: 'Kesesuaian dengan karakteristik peserta didik', id: 'rpl_14' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian kegiatan pendahuluan/pendekatan, inti, dan penutup dengan tahapan layanan BK.', id: 'rpl_15' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian layanan dengan pendekatan/Teknik layanan BK', id: 'rpl_16' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian penyajian/kajian/pembahasan topik/tema/masalah dengan sistematika Layanan BK', id: 'rpl_17' },
            { kategori: 'F. Langkah-langkah / Skenario Layanan BK', komponen: 'Kesesuaian waktu pelaksanaan layanan BK dengan cakupan topik/tema/masalah peserta didik.', id: 'rpl_18' },
            { kategori: 'G. Penilaian', komponen: 'Kesesuaian dengan teknik penilaian proses dan hasil layanan BK', id: 'rpl_19' },
            { kategori: 'G. Penilaian', komponen: 'Kesesuaian dengan dengan tujuan layanan BK', id: 'rpl_20' }
        ];

        // ========== DATA INSTRUMEN PELAKSANAAN ==========
        const instrumenPelaksanaan = [
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Guru BK menyapa dengan kalimat yang membuat siswa bersemangat (menanyakan kabar, kondisi siswa)', id: 'pelaksanaan_1' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Mengajak siswa untuk melakukan permainan atau ice breaking.', id: 'pelaksanaan_2' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Apersepsi dan Motivasi', komponen: 'Menanyakan kesiapan siswa mengikuti kegiatan layanan.', id: 'pelaksanaan_3' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan topik layanan bk', id: 'pelaksanaan_4' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan tujuan layanan BK yang akan dicapai peserta didik.', id: 'pelaksanaan_5' },
            { kategori: 'Kegiatan Pendahuluan', subkategori: 'Penyampaian Rencana Kegiatan', komponen: 'Menyampaikan rencana kegiatan layanan dan batasan waktu kegiatan.', id: 'pelaksanaan_6' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Kemampuan menyesuaikan materi dengan tujuan Layanan BK.', id: 'pelaksanaan_7' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Kemampuan mengkaitkan materi dengan pengetahuan lain yang relevan, perkembangan Iptek, dan kehidupan nyata.', id: 'pelaksanaan_8' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Menyajikan pembahasan materi Layanan BK dengan tepat.', id: 'pelaksanaan_9' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penguasaan Materi Layanan', komponen: 'Menyajikan materi secara sistematis (mudah ke sulit, dari konkrit ke abstrak)', id: 'pelaksanaan_10' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK sesuai dengan kompetensi yang akan dicapai.', id: 'pelaksanaan_11' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Menfasilitasi kegiatan yang memuat komponen eksplorasi, elaborasi dan konfirmasi.', id: 'pelaksanaan_12' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK secara runtut.', id: 'pelaksanaan_13' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Menguasai kelas/kelompok layanan BK', id: 'pelaksanaan_14' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK yang bersifat kontekstual.', id: 'pelaksanaan_15' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK yang memungkinkan tumbuhnya kebiasaan positif (nurturant effect).', id: 'pelaksanaan_16' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penerapan Strategi Layanan BK', komponen: 'Melaksanakan Layanan BK sesuai dengan alokasi waktu yang direncanakan.', id: 'pelaksanaan_17' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menunjukkan keterampilan dalam penggunaan sumber Layanan BK.', id: 'pelaksanaan_18' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menunjukkan keterampilan dalam penggunaan media Layanan BK.', id: 'pelaksanaan_19' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Menghasilkan pesan yang menarik.', id: 'pelaksanaan_20' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Melibatkan peserta didik dalam pemanfaatan sumber Layanan BK.', id: 'pelaksanaan_21' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pemanfaatan Sumber/Media dalam Layanan BK', komponen: 'Melibatkan peserta didik dalam pemanfaatan media Layanan BK.', id: 'pelaksanaan_22' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menumbuhkan partisipasi aktif peserta didik.', id: 'pelaksanaan_23' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Merespon positif partisipasi peserta didik.', id: 'pelaksanaan_24' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menunjukkan sikap terbuka terhadap respons peserta didik.', id: 'pelaksanaan_25' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menunjukkan hubungan antar pribadi yang kondusif.', id: 'pelaksanaan_26' },
            { kategori: 'Kegiatan Inti', subkategori: 'Pelibatan Peserta Didik dalam Layanan BK', komponen: 'Menumbuhkan keceriaan atau antusiasme peserta didik.', id: 'pelaksanaan_27' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penggunaan Bahasa yang Benar dan Tepat dalam Layanan BK', komponen: 'Menggunakan bahasa lisan secara jelas dan lancar.', id: 'pelaksanaan_28' },
            { kategori: 'Kegiatan Inti', subkategori: 'Penggunaan Bahasa yang Benar dan Tepat dalam Layanan BK', komponen: 'Menggunakan bahasa tulis yang baik dan benar.', id: 'pelaksanaan_29' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Melakukan refleksi atau membuat rangkuman dengan melibatkan peserta didik.', id: 'pelaksanaan_30' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Memberikan tes lisan atau tetulis.', id: 'pelaksanaan_31' },
            { kategori: 'Kegiatan Penutup', subkategori: 'Penutup Layanan BK', komponen: 'Melaksanakan tindak lanjut dengan memberikan arahan kegiatan berikutnya.', id: 'pelaksanaan_32' }
        ];

        // ========== DATA INSTRUMEN ADMINISTRASI ==========
        const instrumenAdministrasi = [
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Angket Kebutuhan Peserta Didik', id: 'admin_1' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Data Analisis Kebutuhan Siswa', id: 'admin_2' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Program Layanan BK', id: 'admin_3' },
            { kategori: 'Dokumen Wajib', komponen: 'Kalender Pendidikan dan analisis minggu efektif', id: 'admin_4' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Jadwal Layanan BK', id: 'admin_5' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Standar Kompetensi Kemandirian Peserta Didik.', id: 'admin_6' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Rencana Persiapan Layanan (RPL)', id: 'admin_7' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Kumpulan Materi Layanan BK', id: 'admin_8' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Catatan Kasus', id: 'admin_9' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Agenda Guru / Jurnal Layanan Bimbingan', id: 'admin_10' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Catatan Konseling', id: 'admin_11' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Home Visit', id: 'admin_12' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Kegiatan Konferensi Kasus', id: 'admin_13' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Evaluasi Layanan BK', id: 'admin_14' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki dokumen tindak lanjut layanan BK', id: 'admin_15' },
            { kategori: 'Dokumen Penunjang', komponen: 'Memiliki daftar hadir peserta didik', id: 'admin_16' },
            { kategori: 'Dokumen Penunjang', komponen: 'Melakukan Pengembangan Keprofesian Berkelanjutan', id: 'admin_17' }
        ];

        let currentTab = 'administrasi';
        let savedData = [];

        // ========== URL WEB APP ANDA ==========
        // Ganti dengan URL Web App Anda yang benar
        const SPREADSHEET_URL = 'https://script.google.com/macros/s/AKfycbx5JCLNrJ0kWSk3-9i4kKE8doszruSbwguRIcHewr4-5RdVNh1atqJSmzISIX1XG2hbCA/exec';

        // ========== INITIALIZE APP ==========
        function initApp() {
            renderRPLForm();
            renderPelaksanaanForm();
            renderAdministrasiForm();
            setCurrentDate();
            updateSignatureDisplay();
            loadSavedData();
        }

        // ========== RENDER FUNCTIONS ==========
        function renderRPLForm() {
            const container = document.getElementById('instrumen-rpl-container');
            container.innerHTML = '';
            let currentKategori = '';
            let itemCounter = 0;
            
            instrumenRPL.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="score-radio-group">
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_1" name="${item.id}" value="1" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_1" class="text-sm">1 (Tidak ada)</label>
                            </div>
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_2" name="${item.id}" value="2" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_2" class="text-sm">2 (Kurang Lengkap)</label>
                            </div>
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_3" name="${item.id}" value="3" class="h-4 w-4 text-blue-600" checked>
                                <label for="${item.id}_3" class="text-sm">3 (Sudah Lengkap)</label>
                            </div>
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Catatan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function renderPelaksanaanForm() {
            const container = document.getElementById('instrumen-pelaksanaan-container');
            container.innerHTML = '';
            let currentKategori = '';
            let currentSubkategori = '';
            let itemCounter = 0;
            
            instrumenPelaksanaan.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    currentSubkategori = '';
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                if (item.subkategori !== currentSubkategori) {
                    currentSubkategori = item.subkategori;
                    const subkategoriRow = document.createElement('tr');
                    subkategoriRow.className = 'subcategory-row';
                    subkategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-medium">${currentSubkategori}</td>`;
                    container.appendChild(subkategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="radio-group-horizontal">
                            <div class="radio-option-horizontal">
                                <input type="radio" id="${item.id}_ya" name="${item.id}" value="1" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_ya" class="text-sm">Ya</label>
                            </div>
                            <div class="radio-option-horizontal">
                                <input type="radio" id="${item.id}_tidak" name="${item.id}" value="0" class="h-4 w-4 text-blue-600" checked>
                                <label for="${item.id}_tidak" class="text-sm">Tidak</label>
                            </div>
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Catatan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function renderAdministrasiForm() {
            const container = document.getElementById('instrumen-administrasi-container');
            container.innerHTML = '';
            let currentKategori = '';
            let itemCounter = 0;
            
            instrumenAdministrasi.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${[0,1,2,3,4].map(val => `
                                <div class="flex items-center">
                                    <input type="radio" id="${item.id}_${val}" name="${item.id}" value="${val}" class="h-4 w-4 text-blue-600" ${val === 4 ? 'checked' : ''}>
                                    <label for="${item.id}_${val}" class="ml-1 text-sm">${val}</label>
                                </div>
                            `).join('')}
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Keterangan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        // ========== TAB MANAGEMENT ==========
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.getElementById('tab-rpl-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            document.getElementById('tab-pelaksanaan-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            document.getElementById('tab-administrasi-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            
            document.getElementById('tab-rpl-btn').classList.add('border-transparent');
            document.getElementById('tab-pelaksanaan-btn').classList.add('border-transparent');
            document.getElementById('tab-administrasi-btn').classList.add('border-transparent');
            
            document.getElementById(`tab-${tabName}-btn`).classList.add('border-blue-500', 'text-blue-600');
            document.getElementById(`tab-${tabName}-btn`).classList.remove('border-transparent');
            
            // Update content visibility
            document.getElementById('tab-rpl-content').classList.add('hidden');
            document.getElementById('tab-pelaksanaan-content').classList.add('hidden');
            document.getElementById('tab-administrasi-content').classList.add('hidden');
            document.getElementById(`tab-${tabName}-content`).classList.remove('hidden');
            
            document.getElementById('hasil-penilaian').classList.add('hidden');
        }

        // ========== UTILITY FUNCTIONS ==========
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('signatureDate').value = formattedDate;
            document.getElementById('tanggal_supervisi').value = formattedDate;
        }

        function updateSignatureDisplay() {
            const supervisorName = document.getElementById('nama_supervisor').value;
            const supervisorNip = document.getElementById('nip_supervisor').value;
            const guruName = document.getElementById('nama_guru').value;
            const guruNip = document.getElementById('nip').value;

            document.getElementById('supervisorNameDisplay').textContent = supervisorName || '........................................';
            document.getElementById('supervisorNipDisplay').textContent = `NIP. ${supervisorNip || '.............................'}`;
            document.getElementById('teacherNameDisplay').textContent = guruName || '........................................';
            document.getElementById('teacherNipDisplay').textContent = `NIP. ${guruNip || '.............................'}`;
        }

        // ========== PRINT ALL TABS FUNCTION ==========
        function printAllTabs() {
            // Show all tabs temporarily
            document.getElementById('tab-rpl-content').classList.remove('hidden');
            document.getElementById('tab-pelaksanaan-content').classList.remove('hidden');
            document.getElementById('tab-administrasi-content').classList.remove('hidden');
            
            // Trigger print
            window.print();
            
            // Restore original state after print dialog closes
            setTimeout(() => {
                switchTab(currentTab);
            }, 1000);
        }

        // ========== CALCULATION FUNCTIONS ==========
        function validateAndCalculate() {
            const requiredFields = getRequiredFields();
            let isValid = true;

            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element || element.value.trim() === '') {
                    isValid = false;
                    element.classList.add('border-red-500');
                } else {
                    element.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                alert('Mohon lengkapi semua field yang wajib diisi!');
                return;
            }

            calculateScores();
        }

        function calculateScores() {
            let totalScore = 0;
            let maxScore = 0;
            let items = [];

            if (currentTab === 'rpl') {
                items = instrumenRPL;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length * 3;
            } else if (currentTab === 'pelaksanaan') {
                items = instrumenPelaksanaan;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length;
            } else {
                items = instrumenAdministrasi;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length * 4;
            }

            const percentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
            const grade = calculateGrade(percentage);

            document.getElementById('skor_total').textContent = totalScore;
            document.getElementById('skor_maksimal').textContent = maxScore;
            document.getElementById('nilai_akhir').textContent = `${percentage}%`;
            document.getElementById('keterangan_nilai').textContent = grade;

            updateSignatureDisplay();
            document.getElementById('hasil-penilaian').classList.remove('hidden');
        }

        function calculateGrade(percentage) {
            if (percentage > 90) return 'Amat Baik (AB)';
            if (percentage > 80) return 'Baik (B)';
            if (percentage > 70) return 'Cukup (C)';
            return 'Kurang (K)';
        }

        function getRequiredFields() {
            const baseFields = [
                { id: 'nama_supervisor' }, { id: 'nip_supervisor' },
                { id: 'nama_guru' }, { id: 'nip' },
                { id: 'tahun_pelajaran' }, { id: 'semester' },
                { id: 'kelas' }, { id: 'tanggal_supervisi' }
            ];

            // Tambahkan field jenis layanan sesuai tab
            if (currentTab === 'rpl') {
                return [...baseFields, { id: 'jenis_layanan_rpl' }, { id: 'komentar_rpl' }];
            } else if (currentTab === 'pelaksanaan') {
                return [...baseFields, { id: 'jenis_layanan_pelaksanaan' }, { id: 'komentar_pelaksanaan' }];
            } else {
                return [...baseFields, { id: 'jenis_layanan_admin' }, { id: 'komentar_admin' }];
            }
        }

        // ========== DATA MANAGEMENT - UPDATED FOR YOUR WEB APP ==========
        function saveToSpreadsheet() {
            // Validasi terlebih dahulu
            validateAndCalculate();
            
            // Ambil data dari form
            const data = {
                timestamp: new Date().toISOString(),
                tanggal_supervisi: document.getElementById('tanggal_supervisi').value,
                tahun_pelajaran: document.getElementById('tahun_pelajaran').value,
                semester: document.getElementById('semester').value,
                kelas: document.getElementById('kelas').value,
                nama_supervisor: document.getElementById('nama_supervisor').value,
                nip_supervisor: document.getElementById('nip_supervisor').value,
                nama_guru: document.getElementById('nama_guru').value,
                nip: document.getElementById('nip').value,
                tipe_supervisi: currentTab,
                skor_total: document.getElementById('skor_total').textContent,
                skor_maksimal: document.getElementById('skor_maksimal').textContent,
                nilai_akhir: document.getElementById('nilai_akhir').textContent,
                keterangan_nilai: document.getElementById('keterangan_nilai').textContent
            };
            
            // Ambil jenis layanan sesuai tab
            if (currentTab === 'rpl') {
                data.jenis_layanan = document.getElementById('jenis_layanan_rpl').value;
                data.komentar = document.getElementById('komentar_rpl').value;
            } else if (currentTab === 'pelaksanaan') {
                data.jenis_layanan = document.getElementById('jenis_layanan_pelaksanaan').value;
                data.komentar = document.getElementById('komentar_pelaksanaan').value;
            } else {
                data.jenis_layanan = document.getElementById('jenis_layanan_admin').value;
                data.komentar = document.getElementById('komentar_admin').value;
            }
            
            // Tampilkan loading
            showNotification('Menyimpan data ke spreadsheet...', 'success', true);
            
            // Kirim data ke Google Apps Script
            fetch(SPREADSHEET_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
                mode: 'no-cors' // Tambahkan mode no-cors
            })
            .then(response => {
                // Karena mode no-cors, kita tidak bisa membaca response
                // Anggap berhasil jika tidak ada error
                showNotification('Data berhasil dikirim ke spreadsheet!', 'success');
                saveDataLocally(data);
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Menggunakan mode cadangan. Data disimpan secara lokal.', 'warning');
                // Simpan data lokal jika gagal mengirim ke server
                saveDataLocally(data);
            });
        }

        function saveDataLocally(data) {
            // Tambahkan ID unik
            data.id = Date.now().toString();
            
            // Ambil data yang sudah ada dari localStorage
            const existingData = JSON.parse(localStorage.getItem('supervisiData') || '[]');
            
            // Tambahkan data baru
            existingData.push(data);
            
            // Simpan kembali ke localStorage
            localStorage.setItem('supervisiData', JSON.stringify(existingData));
            
            // Update variabel savedData
            savedData = existingData;
            
            showNotification('Data berhasil disimpan secara lokal!', 'success');
        }

        function loadSavedData() {
            // Ambil data dari localStorage
            const storedData = localStorage.getItem('supervisiData');
            if (storedData) {
                savedData = JSON.parse(storedData);
            } else {
                savedData = [];
            }
        }

        function viewSavedData() {
            // Tampilkan modal
            document.getElementById('dataModal').classList.remove('hidden');
            
            // Tampilkan data
            displaySavedData();
        }

        function displaySavedData(filter = 'all') {
            const container = document.getElementById('savedDataContainer');
            const noDataMessage = document.getElementById('noDataMessage');
            
            // Filter data
            let filteredData = savedData;
            if (filter !== 'all') {
                filteredData = savedData.filter(item => item.tipe_supervisi === filter);
            }
            
            // Kosongkan container
            container.innerHTML = '';
            
            // Periksa apakah ada data
            if (filteredData.length === 0) {
                noDataMessage.classList.remove('hidden');
                return;
            } else {
                noDataMessage.classList.add('hidden');
            }
            
            // Tampilkan data
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                // Format tanggal
                const date = new Date(item.tanggal_supervisi);
                const formattedDate = date.toLocaleDateString('id-ID');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formattedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.tipe_supervisi.toUpperCase()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama_guru}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nilai_akhir}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="loadData('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-2">Muat</button>
                        <button onclick="deleteData('${item.id}')" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }

        function filterData() {
            const filterValue = document.getElementById('filterTab').value;
            displaySavedData(filterValue);
        }

        function loadData(id) {
            // Cari data berdasarkan ID
            const data = savedData.find(item => item.id === id);
            
            if (!data) {
                showNotification('Data tidak ditemukan!', 'error');
                return;
            }
            
            // Isi form dengan data
            document.getElementById('nama_supervisor').value = data.nama_supervisor;
            document.getElementById('nip_supervisor').value = data.nip_supervisor;
            document.getElementById('nama_guru').value = data.nama_guru;
            document.getElementById('nip').value = data.nip;
            document.getElementById('tahun_pelajaran').value = data.tahun_pelajaran;
            document.getElementById('semester').value = data.semester;
            document.getElementById('kelas').value = data.kelas;
            document.getElementById('tanggal_supervisi').value = data.tanggal_supervisi;
            document.getElementById('signatureDate').value = data.tanggal_supervisi;
            
            // Pindah ke tab yang sesuai
            switchTab(data.tipe_supervisi);
            
            // Isi jenis layanan dan komentar berdasarkan tipe
            if (data.tipe_supervisi === 'rpl') {
                document.getElementById('jenis_layanan_rpl').value = data.jenis_layanan;
                document.getElementById('komentar_rpl').value = data.komentar;
            } else if (data.tipe_supervisi === 'pelaksanaan') {
                document.getElementById('jenis_layanan_pelaksanaan').value = data.jenis_layanan;
                document.getElementById('komentar_pelaksanaan').value = data.komentar;
            } else {
                document.getElementById('jenis_layanan_admin').value = data.jenis_layanan;
                document.getElementById('komentar_admin').value = data.komentar;
            }
            
            // Tampilkan hasil penilaian
            document.getElementById('skor_total').textContent = data.skor_total;
            document.getElementById('skor_maksimal').textContent = data.skor_maksimal;
            document.getElementById('nilai_akhir').textContent = data.nilai_akhir;
            document.getElementById('keterangan_nilai').textContent = data.keterangan_nilai;
            document.getElementById('hasil-penilaian').classList.remove('hidden');
            
            // Update tanda tangan
            updateSignatureDisplay();
            
            // Tutup modal
            closeDataModal();
            
            showNotification('Data berhasil dimuat!', 'success');
        }

        function deleteData(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            // Hapus data dari array
            savedData = savedData.filter(item => item.id !== id);
            
            // Simpan kembali ke localStorage
            localStorage.setItem('supervisiData', JSON.stringify(savedData));
            
            // Tampilkan kembali data
            displaySavedData(document.getElementById('filterTab').value);
            
            showNotification('Data berhasil dihapus!', 'success');
        }

        function closeDataModal() {
            document.getElementById('dataModal').classList.add('hidden');
        }

        function exportToCSV() {
            validateAndCalculate();
            
            let csv = "SUPERVISI GURU BK TERPADU - SMKN 1 PURBALINGGA\n";
            csv += `Tipe Supervisi,${currentTab.toUpperCase()}\n`;
            csv += `Tanggal Supervisi,${document.getElementById('tanggal_supervisi').value}\n`;
            csv += `Tahun Pelajaran,${document.getElementById('tahun_pelajaran').value}\n`;
            csv += `Semester,${document.getElementById('semester').value}\n`;
            csv += `Kelas,${document.getElementById('kelas').value}\n`;
            
            // Ambil jenis layanan sesuai tab
            let jenisLayanan = '';
            if (currentTab === 'rpl') {
                jenisLayanan = document.getElementById('jenis_layanan_rpl').value;
            } else if (currentTab === 'pelaksanaan') {
                jenisLayanan = document.getElementById('jenis_layanan_pelaksanaan').value;
            } else {
                jenisLayanan = document.getElementById('jenis_layanan_admin').value;
            }
            csv += `Jenis Layanan,${jenisLayanan}\n`;
            
            csv += `Supervisor,${document.getElementById('nama_supervisor').value}\n`;
            csv += `NIP Supervisor,${document.getElementById('nip_supervisor').value}\n`;
            csv += `Guru BK,${document.getElementById('nama_guru').value}\n`;
            csv += `NIP Guru BK,${document.getElementById('nip').value}\n\n`;

            // Add results
            csv += `Skor Total,${document.getElementById('skor_total').textContent}\n`;
            csv += `Skor Maksimal,${document.getElementById('skor_maksimal').textContent}\n`;
            csv += `Nilai Akhir,${document.getElementById('nilai_akhir').textContent}\n`;
            csv += `Peringkat,${document.getElementById('keterangan_nilai').textContent}\n`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `supervisi_bk_${currentTab}_${document.getElementById('nama_guru').value.replace(/\s+/g, '_')}_${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function resetForm() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                document.getElementById('nama_guru').value = '';
                document.getElementById('nip').value = '';
                document.getElementById('tahun_pelajaran').value = '2025/2026';
                document.getElementById('semester').value = 'Ganjil';
                document.getElementById('kelas').value = '';
                document.getElementById('tanggal_supervisi').value = '';
                document.getElementById('jenis_layanan_rpl').value = '';
                document.getElementById('jenis_layanan_pelaksanaan').value = '';
                document.getElementById('jenis_layanan_admin').value = '';
                document.getElementById('komentar_admin').value = '';
                document.getElementById('komentar_rpl').value = '';
                document.getElementById('komentar_pelaksanaan').value = '';

                // Reset semua radio buttons ke nilai default
                const allRadios = document.querySelectorAll('input[type="radio"]');
                allRadios.forEach(radio => {
                    if ((currentTab === 'rpl' && radio.value === '3') || 
                        (currentTab === 'pelaksanaan' && radio.value === '0') ||
                        (currentTab === 'administrasi' && radio.value === '4')) {
                        radio.checked = true;
                    } else {
                        radio.checked = false;
                    }
                });

                // Reset semua textareas
                const allTextareas = document.querySelectorAll('textarea');
                allTextareas.forEach(textarea => {
                    if (!textarea.id.includes('komentar')) {
                        textarea.value = '';
                    }
                });

                document.getElementById('hasil-penilaian').classList.add('hidden');
                setCurrentDate();
                updateSignatureDisplay();
                
                alert('Form telah direset!');
            }
        }

        // ========== NOTIFICATION SYSTEM ==========
        function showNotification(message, type = 'success', showSpinner = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const notificationSpinner = document.getElementById('notificationSpinner');
            
            notificationText.textContent = message;
            
            // Set background color based on type
            if (type === 'success') {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-green-500 text-white flex items-center gap-3';
            } else if (type === 'warning') {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-yellow-500 text-white flex items-center gap-3';
            } else {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-red-500 text-white flex items-center gap-3';
            }
            
            // Show/hide spinner
            if (showSpinner) {
                notificationSpinner.classList.remove('hidden');
            } else {
                notificationSpinner.classList.add('hidden');
            }
            
            // Show notification
            notification.classList.remove('hidden');
            
            // Auto hide after 3 seconds if not showing spinner
            if (!showSpinner) {
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }
        }

        // Initialize when page loads
        window.onload = initApp;
    </script>
</body>
</html>';

        // ========== INITIALIZE APP ==========
        function initApp() {
            renderRPLForm();
            renderPelaksanaanForm();
            renderAdministrasiForm();
            setCurrentDate();
            updateSignatureDisplay();
            loadSavedData();
        }

        // ========== RENDER FUNCTIONS ==========
        function renderRPLForm() {
            const container = document.getElementById('instrumen-rpl-container');
            container.innerHTML = '';
            let currentKategori = '';
            let itemCounter = 0;
            
            instrumenRPL.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="score-radio-group">
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_1" name="${item.id}" value="1" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_1" class="text-sm">1 (Tidak ada)</label>
                            </div>
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_2" name="${item.id}" value="2" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_2" class="text-sm">2 (Kurang Lengkap)</label>
                            </div>
                            <div class="score-radio-option">
                                <input type="radio" id="${item.id}_3" name="${item.id}" value="3" class="h-4 w-4 text-blue-600" checked>
                                <label for="${item.id}_3" class="text-sm">3 (Sudah Lengkap)</label>
                            </div>
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Catatan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function renderPelaksanaanForm() {
            const container = document.getElementById('instrumen-pelaksanaan-container');
            container.innerHTML = '';
            let currentKategori = '';
            let currentSubkategori = '';
            let itemCounter = 0;
            
            instrumenPelaksanaan.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    currentSubkategori = '';
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                if (item.subkategori !== currentSubkategori) {
                    currentSubkategori = item.subkategori;
                    const subkategoriRow = document.createElement('tr');
                    subkategoriRow.className = 'subcategory-row';
                    subkategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-medium">${currentSubkategori}</td>`;
                    container.appendChild(subkategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="radio-group-horizontal">
                            <div class="radio-option-horizontal">
                                <input type="radio" id="${item.id}_ya" name="${item.id}" value="1" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_ya" class="text-sm">Ya</label>
                            </div>
                            <div class="radio-option-horizontal">
                                <input type="radio" id="${item.id}_tidak" name="${item.id}" value="0" class="h-4 w-4 text-blue-600" checked>
                                <label for="${item.id}_tidak" class="text-sm">Tidak</label>
                            </div>
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Catatan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function renderAdministrasiForm() {
            const container = document.getElementById('instrumen-administrasi-container');
            container.innerHTML = '';
            let currentKategori = '';
            let itemCounter = 0;
            
            instrumenAdministrasi.forEach((item) => {
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3 font-bold">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                const row = document.createElement('tr');
                itemCounter++;
                
                row.innerHTML = `
                    <td class="text-center font-medium">${itemCounter}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${[0,1,2,3,4].map(val => `
                                <div class="flex items-center">
                                    <input type="radio" id="${item.id}_${val}" name="${item.id}" value="${val}" class="h-4 w-4 text-blue-600" ${val === 4 ? 'checked' : ''}>
                                    <label for="${item.id}_${val}" class="ml-1 text-sm">${val}</label>
                                </div>
                            `).join('')}
                        </div>
                    </td>
                    <td>
                        <textarea id="keterangan_${item.id}" placeholder="Keterangan..." class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        // ========== TAB MANAGEMENT ==========
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.getElementById('tab-rpl-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            document.getElementById('tab-pelaksanaan-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            document.getElementById('tab-administrasi-btn').classList.remove('active', 'border-blue-500', 'text-blue-600');
            
            document.getElementById('tab-rpl-btn').classList.add('border-transparent');
            document.getElementById('tab-pelaksanaan-btn').classList.add('border-transparent');
            document.getElementById('tab-administrasi-btn').classList.add('border-transparent');
            
            document.getElementById(`tab-${tabName}-btn`).classList.add('border-blue-500', 'text-blue-600');
            document.getElementById(`tab-${tabName}-btn`).classList.remove('border-transparent');
            
            // Update content visibility
            document.getElementById('tab-rpl-content').classList.add('hidden');
            document.getElementById('tab-pelaksanaan-content').classList.add('hidden');
            document.getElementById('tab-administrasi-content').classList.add('hidden');
            document.getElementById(`tab-${tabName}-content`).classList.remove('hidden');
            
            document.getElementById('hasil-penilaian').classList.add('hidden');
        }

        // ========== UTILITY FUNCTIONS ==========
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('signatureDate').value = formattedDate;
            document.getElementById('tanggal_supervisi').value = formattedDate;
        }

        function updateSignatureDisplay() {
            const supervisorName = document.getElementById('nama_supervisor').value;
            const supervisorNip = document.getElementById('nip_supervisor').value;
            const guruName = document.getElementById('nama_guru').value;
            const guruNip = document.getElementById('nip').value;

            document.getElementById('supervisorNameDisplay').textContent = supervisorName || '........................................';
            document.getElementById('supervisorNipDisplay').textContent = `NIP. ${supervisorNip || '.............................'}`;
            document.getElementById('teacherNameDisplay').textContent = guruName || '........................................';
            document.getElementById('teacherNipDisplay').textContent = `NIP. ${guruNip || '.............................'}`;
        }

        // ========== PRINT ALL TABS FUNCTION ==========
        function printAllTabs() {
            // Show all tabs temporarily
            document.getElementById('tab-rpl-content').classList.remove('hidden');
            document.getElementById('tab-pelaksanaan-content').classList.remove('hidden');
            document.getElementById('tab-administrasi-content').classList.remove('hidden');
            
            // Trigger print
            window.print();
            
            // Restore original state after print dialog closes
            setTimeout(() => {
                switchTab(currentTab);
            }, 1000);
        }

        // ========== CALCULATION FUNCTIONS ==========
        function validateAndCalculate() {
            const requiredFields = getRequiredFields();
            let isValid = true;

            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element || element.value.trim() === '') {
                    isValid = false;
                    element.classList.add('border-red-500');
                } else {
                    element.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                alert('Mohon lengkapi semua field yang wajib diisi!');
                return;
            }

            calculateScores();
        }

        function calculateScores() {
            let totalScore = 0;
            let maxScore = 0;
            let items = [];

            if (currentTab === 'rpl') {
                items = instrumenRPL;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length * 3;
            } else if (currentTab === 'pelaksanaan') {
                items = instrumenPelaksanaan;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length;
            } else {
                items = instrumenAdministrasi;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        totalScore += parseInt(score.value);
                    }
                });
                maxScore = items.length * 4;
            }

            const percentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
            const grade = calculateGrade(percentage);

            document.getElementById('skor_total').textContent = totalScore;
            document.getElementById('skor_maksimal').textContent = maxScore;
            document.getElementById('nilai_akhir').textContent = `${percentage}%`;
            document.getElementById('keterangan_nilai').textContent = grade;

            updateSignatureDisplay();
            document.getElementById('hasil-penilaian').classList.remove('hidden');
        }

        function calculateGrade(percentage) {
            if (percentage > 90) return 'Amat Baik (AB)';
            if (percentage > 80) return 'Baik (B)';
            if (percentage > 70) return 'Cukup (C)';
            return 'Kurang (K)';
        }

        function getRequiredFields() {
            const baseFields = [
                { id: 'nama_supervisor' }, { id: 'nip_supervisor' },
                { id: 'nama_guru' }, { id: 'nip' },
                { id: 'tahun_pelajaran' }, { id: 'semester' },
                { id: 'kelas' }, { id: 'tanggal_supervisi' }
            ];

            // Tambahkan field jenis layanan sesuai tab
            if (currentTab === 'rpl') {
                return [...baseFields, { id: 'jenis_layanan_rpl' }, { id: 'komentar_rpl' }];
            } else if (currentTab === 'pelaksanaan') {
                return [...baseFields, { id: 'jenis_layanan_pelaksanaan' }, { id: 'komentar_pelaksanaan' }];
            } else {
                return [...baseFields, { id: 'jenis_layanan_admin' }, { id: 'komentar_admin' }];
            }
        }

        // ========== DATA MANAGEMENT - UPDATED FOR YOUR WEB APP ==========
        function saveToSpreadsheet() {
            // Validasi terlebih dahulu
            validateAndCalculate();
            
            // Ambil data dari form
            const data = {
                timestamp: new Date().toISOString(),
                tanggal_supervisi: document.getElementById('tanggal_supervisi').value,
                tahun_pelajaran: document.getElementById('tahun_pelajaran').value,
                semester: document.getElementById('semester').value,
                kelas: document.getElementById('kelas').value,
                nama_supervisor: document.getElementById('nama_supervisor').value,
                nip_supervisor: document.getElementById('nip_supervisor').value,
                nama_guru: document.getElementById('nama_guru').value,
                nip: document.getElementById('nip').value,
                tipe_supervisi: currentTab,
                skor_total: document.getElementById('skor_total').textContent,
                skor_maksimal: document.getElementById('skor_maksimal').textContent,
                nilai_akhir: document.getElementById('nilai_akhir').textContent,
                keterangan_nilai: document.getElementById('keterangan_nilai').textContent
            };
            
            // Ambil jenis layanan sesuai tab
            if (currentTab === 'rpl') {
                data.jenis_layanan = document.getElementById('jenis_layanan_rpl').value;
                data.komentar = document.getElementById('komentar_rpl').value;
            } else if (currentTab === 'pelaksanaan') {
                data.jenis_layanan = document.getElementById('jenis_layanan_pelaksanaan').value;
                data.komentar = document.getElementById('komentar_pelaksanaan').value;
            } else {
                data.jenis_layanan = document.getElementById('jenis_layanan_admin').value;
                data.komentar = document.getElementById('komentar_admin').value;
            }
            
            // Tampilkan loading
            showNotification('Menyimpan data ke spreadsheet...', 'success', true);
            
            // Kirim data ke Google Apps Script
            fetch(SPREADSHEET_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
                mode: 'no-cors' // Tambahkan mode no-cors
            })
            .then(response => {
                // Karena mode no-cors, kita tidak bisa membaca response
                // Anggap berhasil jika tidak ada error
                showNotification('Data berhasil dikirim ke spreadsheet!', 'success');
                saveDataLocally(data);
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Menggunakan mode cadangan. Data disimpan secara lokal.', 'warning');
                // Simpan data lokal jika gagal mengirim ke server
                saveDataLocally(data);
            });
        }

        function saveDataLocally(data) {
            // Tambahkan ID unik
            data.id = Date.now().toString();
            
            // Ambil data yang sudah ada dari localStorage
            const existingData = JSON.parse(localStorage.getItem('supervisiData') || '[]');
            
            // Tambahkan data baru
            existingData.push(data);
            
            // Simpan kembali ke localStorage
            localStorage.setItem('supervisiData', JSON.stringify(existingData));
            
            // Update variabel savedData
            savedData = existingData;
            
            showNotification('Data berhasil disimpan secara lokal!', 'success');
        }

        function loadSavedData() {
            // Ambil data dari localStorage
            const storedData = localStorage.getItem('supervisiData');
            if (storedData) {
                savedData = JSON.parse(storedData);
            } else {
                savedData = [];
            }
        }

        function viewSavedData() {
            // Tampilkan modal
            document.getElementById('dataModal').classList.remove('hidden');
            
            // Tampilkan data
            displaySavedData();
        }

        function displaySavedData(filter = 'all') {
            const container = document.getElementById('savedDataContainer');
            const noDataMessage = document.getElementById('noDataMessage');
            
            // Filter data
            let filteredData = savedData;
            if (filter !== 'all') {
                filteredData = savedData.filter(item => item.tipe_supervisi === filter);
            }
            
            // Kosongkan container
            container.innerHTML = '';
            
            // Periksa apakah ada data
            if (filteredData.length === 0) {
                noDataMessage.classList.remove('hidden');
                return;
            } else {
                noDataMessage.classList.add('hidden');
            }
            
            // Tampilkan data
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                
                // Format tanggal
                const date = new Date(item.tanggal_supervisi);
                const formattedDate = date.toLocaleDateString('id-ID');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formattedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.tipe_supervisi.toUpperCase()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nama_guru}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.nilai_akhir}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="loadData('${item.id}')" class="text-indigo-600 hover:text-indigo-900 mr-2">Muat</button>
                        <button onclick="deleteData('${item.id}')" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }

        function filterData() {
            const filterValue = document.getElementById('filterTab').value;
            displaySavedData(filterValue);
        }

        function loadData(id) {
            // Cari data berdasarkan ID
            const data = savedData.find(item => item.id === id);
            
            if (!data) {
                showNotification('Data tidak ditemukan!', 'error');
                return;
            }
            
            // Isi form dengan data
            document.getElementById('nama_supervisor').value = data.nama_supervisor;
            document.getElementById('nip_supervisor').value = data.nip_supervisor;
            document.getElementById('nama_guru').value = data.nama_guru;
            document.getElementById('nip').value = data.nip;
            document.getElementById('tahun_pelajaran').value = data.tahun_pelajaran;
            document.getElementById('semester').value = data.semester;
            document.getElementById('kelas').value = data.kelas;
            document.getElementById('tanggal_supervisi').value = data.tanggal_supervisi;
            document.getElementById('signatureDate').value = data.tanggal_supervisi;
            
            // Pindah ke tab yang sesuai
            switchTab(data.tipe_supervisi);
            
            // Isi jenis layanan dan komentar berdasarkan tipe
            if (data.tipe_supervisi === 'rpl') {
                document.getElementById('jenis_layanan_rpl').value = data.jenis_layanan;
                document.getElementById('komentar_rpl').value = data.komentar;
            } else if (data.tipe_supervisi === 'pelaksanaan') {
                document.getElementById('jenis_layanan_pelaksanaan').value = data.jenis_layanan;
                document.getElementById('komentar_pelaksanaan').value = data.komentar;
            } else {
                document.getElementById('jenis_layanan_admin').value = data.jenis_layanan;
                document.getElementById('komentar_admin').value = data.komentar;
            }
            
            // Tampilkan hasil penilaian
            document.getElementById('skor_total').textContent = data.skor_total;
            document.getElementById('skor_maksimal').textContent = data.skor_maksimal;
            document.getElementById('nilai_akhir').textContent = data.nilai_akhir;
            document.getElementById('keterangan_nilai').textContent = data.keterangan_nilai;
            document.getElementById('hasil-penilaian').classList.remove('hidden');
            
            // Update tanda tangan
            updateSignatureDisplay();
            
            // Tutup modal
            closeDataModal();
            
            showNotification('Data berhasil dimuat!', 'success');
        }

        function deleteData(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            // Hapus data dari array
            savedData = savedData.filter(item => item.id !== id);
            
            // Simpan kembali ke localStorage
            localStorage.setItem('supervisiData', JSON.stringify(savedData));
            
            // Tampilkan kembali data
            displaySavedData(document.getElementById('filterTab').value);
            
            showNotification('Data berhasil dihapus!', 'success');
        }

        function closeDataModal() {
            document.getElementById('dataModal').classList.add('hidden');
        }

        function exportToCSV() {
            validateAndCalculate();
            
            let csv = "SUPERVISI GURU BK TERPADU - SMKN 1 PURBALINGGA\n";
            csv += `Tipe Supervisi,${currentTab.toUpperCase()}\n`;
            csv += `Tanggal Supervisi,${document.getElementById('tanggal_supervisi').value}\n`;
            csv += `Tahun Pelajaran,${document.getElementById('tahun_pelajaran').value}\n`;
            csv += `Semester,${document.getElementById('semester').value}\n`;
            csv += `Kelas,${document.getElementById('kelas').value}\n`;
            
            // Ambil jenis layanan sesuai tab
            let jenisLayanan = '';
            if (currentTab === 'rpl') {
                jenisLayanan = document.getElementById('jenis_layanan_rpl').value;
            } else if (currentTab === 'pelaksanaan') {
                jenisLayanan = document.getElementById('jenis_layanan_pelaksanaan').value;
            } else {
                jenisLayanan = document.getElementById('jenis_layanan_admin').value;
            }
            csv += `Jenis Layanan,${jenisLayanan}\n`;
            
            csv += `Supervisor,${document.getElementById('nama_supervisor').value}\n`;
            csv += `NIP Supervisor,${document.getElementById('nip_supervisor').value}\n`;
            csv += `Guru BK,${document.getElementById('nama_guru').value}\n`;
            csv += `NIP Guru BK,${document.getElementById('nip').value}\n\n`;

            // Add results
            csv += `Skor Total,${document.getElementById('skor_total').textContent}\n`;
            csv += `Skor Maksimal,${document.getElementById('skor_maksimal').textContent}\n`;
            csv += `Nilai Akhir,${document.getElementById('nilai_akhir').textContent}\n`;
            csv += `Peringkat,${document.getElementById('keterangan_nilai').textContent}\n`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `supervisi_bk_${currentTab}_${document.getElementById('nama_guru').value.replace(/\s+/g, '_')}_${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function resetForm() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                document.getElementById('nama_guru').value = '';
                document.getElementById('nip').value = '';
                document.getElementById('tahun_pelajaran').value = '2025/2026';
                document.getElementById('semester').value = 'Ganjil';
                document.getElementById('kelas').value = '';
                document.getElementById('tanggal_supervisi').value = '';
                document.getElementById('jenis_layanan_rpl').value = '';
                document.getElementById('jenis_layanan_pelaksanaan').value = '';
                document.getElementById('jenis_layanan_admin').value = '';
                document.getElementById('komentar_admin').value = '';
                document.getElementById('komentar_rpl').value = '';
                document.getElementById('komentar_pelaksanaan').value = '';

                // Reset semua radio buttons ke nilai default
                const allRadios = document.querySelectorAll('input[type="radio"]');
                allRadios.forEach(radio => {
                    if ((currentTab === 'rpl' && radio.value === '3') || 
                        (currentTab === 'pelaksanaan' && radio.value === '0') ||
                        (currentTab === 'administrasi' && radio.value === '4')) {
                        radio.checked = true;
                    } else {
                        radio.checked = false;
                    }
                });

                // Reset semua textareas
                const allTextareas = document.querySelectorAll('textarea');
                allTextareas.forEach(textarea => {
                    if (!textarea.id.includes('komentar')) {
                        textarea.value = '';
                    }
                });

                document.getElementById('hasil-penilaian').classList.add('hidden');
                setCurrentDate();
                updateSignatureDisplay();
                
                alert('Form telah direset!');
            }
        }

        // ========== NOTIFICATION SYSTEM ==========
        function showNotification(message, type = 'success', showSpinner = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const notificationSpinner = document.getElementById('notificationSpinner');
            
            notificationText.textContent = message;
            
            // Set background color based on type
            if (type === 'success') {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-green-500 text-white flex items-center gap-3';
            } else if (type === 'warning') {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-yellow-500 text-white flex items-center gap-3';
            } else {
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-red-500 text-white flex items-center gap-3';
            }
            
            // Show/hide spinner
            if (showSpinner) {
                notificationSpinner.classList.remove('hidden');
            } else {
                notificationSpinner.classList.add('hidden');
            }
            
            // Show notification
            notification.classList.remove('hidden');
            
            // Auto hide after 3 seconds if not showing spinner
            if (!showSpinner) {
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }
        }

        // Initialize when page loads
        window.onload = initApp;
    </script>
</body>
</html>
