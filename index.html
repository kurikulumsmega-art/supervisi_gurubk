<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisi Guru BK - SMKN 1 Purbalingga</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-btn.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        @media print {
            @page {
                size: 210mm 330mm;
                margin: 25mm 15mm 15mm 10mm;
            }
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            body {
                background-color: #fff;
                font-size: 12pt;
                width: 210mm;
                height: 330mm;
            }
            .container {
                padding: 0;
                max-width: 100% !important;
            }
            div[class*="shadow"] {
                box-shadow: none;
                border: 1px solid #e5e7eb;
            }
            #signature-section {
                page-break-inside: avoid;
            }
            .table-print {
                border-collapse: collapse;
                width: 100%;
                font-size: 10pt;
            }
            .table-print th, .table-print td {
                border: 1px solid #000;
                padding: 6px;
                text-align: left;
                vertical-align: top;
            }
            .table-print th {
                background-color: #f3f4f6;
            }
            .page-break {
                page-break-after: always;
            }
            .print-header {
                display: flex !important;
                align-items: center;
                margin-bottom: 15px;
                border-bottom: 2px solid #3b82f6;
                padding-bottom: 10px;
            }
            .print-logo {
                width: 80px;
                height: 80px;
                margin-right: 15px;
            }
            .print-school-info {
                text-align: left;
            }
            .signature-canvas {
                border: 1px solid #000 !important;
            }
        }
        .print-only {
            display: none;
        }
        .required-field::after {
            content: " *";
            color: #ef4444;
        }
        .signature-box {
            border: 1px solid #e5e7eb;
            height: 100px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .table-container {
            overflow-x: auto;
        }
        .table-view {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .table-view th, .table-view td {
            border: 1px solid #e2e8f0;
            padding: 12px 16px;
            text-align: left;
            vertical-align: top;
        }
        .table-view th {
            background-color: #3b82f6;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        .table-view tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .table-view tr:hover {
            background-color: #f1f5f9;
        }
        .category-row {
            background-color: #e0f2fe !important;
            font-weight: 600;
            color: #0c4a6e;
        }
        .category-row td {
            padding: 10px 16px;
            font-size: 0.95rem;
        }
        .signature-canvas {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background-color: white;
            cursor: crosshair;
        }
        .signature-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .signature-preview {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background-color: white;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }
        .signature-preview img {
            max-width: 100%;
            max-height: 100px;
        }
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .radio-option {
            display: flex;
            align-items: center;
            padding: 4px 0;
        }
        .radio-option input[type="radio"] {
            margin-right: 8px;
        }
        .score-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
            margin-top: 8px;
            resize: vertical;
        }
        .table-note {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 8px;
            font-style: italic;
        }
        .table-responsive {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .table-header {
            background-color: #3b82f6;
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <!-- Header untuk Print -->
        <div class="print-only print-header">
            <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/960px-Logo_SMK_Negeri_1_Purbalingga.png" 
                 alt="Logo SMK Negeri 1 Purbalingga" class="print-logo">
            <div class="print-school-info">
                <h1 class="text-xl font-bold text-blue-600">Supervisi Guru Bimbingan Konseling</h1>
                <p class="text-lg font-semibold text-gray-700">SMK Negeri 1 Purbalingga</p>
                <p class="text-sm text-gray-600 mt-1">Jl. Mayor Jend. Sungkono No.34, Selabaya, Kec. Kalimanah, Kabupaten Purbalingga, Jawa Tengah 53371</p>
            </div>
        </div>

        <!-- Header untuk Screen -->
        <header class="text-center mb-8 bg-white p-6 rounded-xl shadow-sm no-print">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-600">Supervisi Guru BK</h1>
            <p class="text-lg md:text-xl font-semibold text-gray-700">SMK Negeri 1 Purbalingga</p>
        </header>

        <!-- Informasi Personal -->
        <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Personal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Supervisor -->
                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="text-lg font-semibold text-blue-600 mb-3">Supervisor</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_supervisor" class="block text-sm font-medium text-gray-600 required-field">Nama Supervisor</label>
                            <input type="text" id="nama_supervisor" value="Maryono, S.Pd., M.Si" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="nip_supervisor" class="block text-sm font-medium text-gray-600 required-field">NIP Supervisor</label>
                            <input type="text" id="nip_supervisor" value="196607012000121002" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- Guru BK -->
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="text-lg font-semibold text-green-600 mb-3">Guru BK</h3>
                    <div class="space-y-3">
                        <div>
                            <label for="nama_guru" class="block text-sm font-medium text-gray-600 required-field">Nama Guru BK</label>
                            <input type="text" id="nama_guru" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="nip" class="block text-sm font-medium text-gray-600 required-field">NIP Guru BK</label>
                            <input type="text" id="nip" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 flex justify-center border-b border-gray-300 no-print">
            <button id="tab-klasikal-btn" class="tab-btn active text-lg py-3 px-6 border-b-2 border-transparent transition-colors duration-300" onclick="switchTab('klasikal')">Bimbingan Klasikal</button>
            <button id="tab-administrasi-btn" class="tab-btn text-lg py-3 px-6 border-b-2 border-transparent transition-colors duration-300" onclick="switchTab('administrasi')">Administrasi BK</button>
        </div>

        <main id="app-content">
            <!-- Informasi Umum -->
            <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-700">Informasi Umum</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="info-klasikal">
                        <div>
                            <label for="kelas_semester" class="block text-sm font-medium text-gray-600 required-field">Kelas/Semester</label>
                            <input type="text" id="kelas_semester" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="tanggal" class="block text-sm font-medium text-gray-600 required-field">Hari, Tanggal (Jam ke)</label>
                            <input type="text" id="tanggal" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div id="info-administrasi" class="hidden">
                        <div>
                            <label for="tahun_pelajaran" class="block text-sm font-medium text-gray-600 required-field">Tahun Pelajaran</label>
                            <input type="text" id="tahun_pelajaran" value="2024/2025" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="semester" class="block text-sm font-medium text-gray-600 required-field">Semester</label>
                            <input type="text" id="semester" value="Ganjil" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Konten Tab Klasikal -->
            <div id="tab-klasikal-content">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="table-header">
                        <h2 class="text-xl font-bold">Instrumen Supervisi Bimbingan Klasikal</h2>
                    </div>
                    
                    <!-- Tabel untuk tampilan desktop -->
                    <div class="table-responsive no-print">
                        <table class="table-view">
                            <thead>
                                <tr>
                                    <th width="5%">No</th>
                                    <th width="25%">Kategori</th>
                                    <th width="45%">Aspek Penilaian</th>
                                    <th width="25%">Penilaian</th>
                                </tr>
                            </thead>
                            <tbody id="instrumen-klasikal-container">
                                <!-- Diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Tabel untuk print -->
                    <div class="print-only">
                        <table class="table-print">
                            <thead>
                                <tr>
                                    <th width="5%">No</th>
                                    <th width="25%">Kategori</th>
                                    <th width="45%">Aspek Penilaian</th>
                                    <th width="10%">Skor</th>
                                    <th width="15%">Catatan</th>
                                </tr>
                            </thead>
                            <tbody id="instrumen-klasikal-print">
                                <!-- Diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Summary Klasikal -->
                    <div id="summary-klasikal" class="p-6 space-y-4">
                        <div>
                            <label for="kesimpulan_klasikal" class="block text-sm font-medium text-gray-600 required-field">Kesimpulan</label>
                            <textarea id="kesimpulan_klasikal" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div>
                            <label for="refleksi_klasikal" class="block text-sm font-medium text-gray-600 required-field">Refleksi</label>
                            <textarea id="refleksi_klasikal" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div>
                            <label for="rekomendasi_klasikal" class="block text-sm font-medium text-gray-600 required-field">Rekomendasi</label>
                            <textarea id="rekomendasi_klasikal" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Konten Tab Administrasi -->
            <div id="tab-administrasi-content" class="hidden">
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="table-header">
                        <h2 class="text-xl font-bold">Supervisi Administrasi Guru BK</h2>
                    </div>
                    
                    <!-- Tabel untuk tampilan desktop -->
                    <div class="table-responsive no-print">
                        <table class="table-view">
                            <thead>
                                <tr>
                                    <th width="5%">No</th>
                                    <th width="25%">Kategori</th>
                                    <th width="45%">Komponen Administrasi</th>
                                    <th width="25%">Penilaian</th>
                                </tr>
                            </thead>
                            <tbody id="instrumen-administrasi-container">
                                <!-- Diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Tabel untuk print -->
                    <div class="print-only">
                        <table class="table-print">
                            <thead>
                                <tr>
                                    <th width="5%">No</th>
                                    <th width="25%">Kategori</th>
                                    <th width="45%">Komponen Administrasi</th>
                                    <th width="10%">Skor</th>
                                    <th width="15%">Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="instrumen-administrasi-print">
                                <!-- Diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Summary Administrasi -->
                    <div id="summary-administrasi" class="p-6 space-y-4">
                        <div>
                            <label for="komentar_admin" class="block text-sm font-medium text-gray-600 required-field">Komentar / Saran</label>
                            <textarea id="komentar_admin" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-white p-6 rounded-xl shadow-sm mt-6 no-print">
                <div class="flex flex-col sm:flex-row items-center justify-between">
                    <div class="flex flex-wrap gap-2 justify-center w-full">
                        <button onclick="validateAndCalculate()" class="flex-grow sm:flex-grow-0 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300 shadow-sm">
                            <i class="fas fa-calculator mr-2"></i>Hitung Skor & Simpan
                        </button>
                        <button onclick="exportToCSV()" class="flex-grow sm:flex-grow-0 bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition duration-300 shadow-sm">
                            <i class="fas fa-file-csv mr-2"></i>Export ke CSV
                        </button>
                        <button onclick="window.print()" class="flex-grow sm:flex-grow-0 bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition duration-300 shadow-sm">
                            <i class="fas fa-print mr-2"></i>Cetak Laporan
                        </button>
                        <button onclick="resetForm()" class="flex-grow sm:flex-grow-0 bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition duration-300 shadow-sm">
                            <i class="fas fa-redo mr-2"></i>Reset Form
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hasil Penilaian -->
            <div id="hasil-penilaian" class="bg-white p-6 rounded-xl shadow-sm mt-6 hidden">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Hasil Penilaian</h3>
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div>
                            <p class="text-sm text-gray-600">Skor Total</p>
                            <p class="text-2xl font-bold text-blue-700" id="skor_total">0</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Skor Maksimal</p>
                            <p class="text-2xl font-bold text-blue-700" id="skor_maksimal">0</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Nilai Akhir</p>
                            <p class="text-2xl font-bold text-blue-700" id="nilai_akhir">0%</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600" id="peringkat-label">Peringkat</p>
                            <p class="text-2xl font-bold text-blue-700" id="keterangan_nilai">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Validasi / Tanda Tangan -->
            <section id="signature-section" class="bg-white p-6 rounded-xl shadow-sm mt-6">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 flex items-center">
                    <i class="fas fa-file-signature mr-3"></i>VALIDASI
                </h2>
                
                <div class="text-center mb-6">
                    <label class="text-sm font-medium text-gray-700 mr-2">Purbalingga,</label>
                    <input type="date" id="signatureDate" class="p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <!-- Supervisor dengan Tanda Tangan Digital -->
                    <div class="text-center flex flex-col">
                        <p class="font-semibold text-gray-700">Supervisor</p>
                        
                        <!-- Canvas untuk tanda tangan digital -->
                        <div class="no-print">
                            <p class="text-sm text-gray-500 mb-2">Gambar tanda tangan di bawah ini:</p>
                            <canvas id="signatureCanvas" class="signature-canvas" width="300" height="150"></canvas>
                            <div class="signature-controls">
                                <button onclick="clearSignature()" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                                    <i class="fas fa-eraser mr-1"></i>Hapus
                                </button>
                                <button onclick="saveSignature()" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                                    <i class="fas fa-save mr-1"></i>Simpan
                                </button>
                            </div>
                            <div id="signaturePreview" class="signature-preview">
                                <span class="text-gray-400 text-sm">Pratinjau tanda tangan akan muncul di sini</span>
                            </div>
                        </div>
                        
                        <!-- Tampilan untuk print -->
                        <div class="print-only">
                            <div class="signature-box flex items-center justify-center">
                                <span class="text-gray-400 text-sm">Tanda Tangan Digital</span>
                            </div>
                        </div>
                        
                        <p class="font-bold text-gray-800 border-t pt-2 mt-2" id="supervisorNameDisplay">........................................</p>
                        <p class="text-xs text-gray-500" id="supervisorNipDisplay">NIP. .............................</p>
                    </div>
                    
                    <!-- Guru BK (manual) -->
                    <div class="text-center flex flex-col">
                        <p class="font-semibold text-gray-700">Guru BK</p>
                        <div class="signature-box flex items-center justify-center">
                            <span class="text-gray-400 text-sm">Tanda Tangan</span>
                        </div>
                        <p class="font-bold text-gray-800 border-t pt-2 mt-2" id="teacherNameDisplay">........................................</p>
                        <p class="text-xs text-gray-500" id="teacherNipDisplay">NIP. .............................</p>
                    </div>
                </div>
                
                <div class="text-center pt-6 border-t border-dashed">
                    <p class="font-semibold text-gray-700">Mengetahui, Kepala Sekolah</p>
                    <div class="signature-box mx-auto flex items-center justify-center" style="max-width: 300px;">
                        <span class="text-gray-400 text-sm">Tanda Tangan</span>
                    </div>
                    <p class="font-bold text-gray-800 border-t pt-2 mt-2 mx-auto" style="max-width: 300px;">Maryono S.Pd, M.Si</p>
                    <p class="text-xs text-gray-500">NIP. 19660701 2000121002</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Data Instrumen
        const instrumenKlasikal = [
            { kategori: 'A. PERSIAPAN PELAKSANAAN BIMBINGAN KLASIKAL', aspek: 'Melaksanakan asesmen kebutuhan materi bimbingan klasikal', id: 'klasikal_1' },
            { kategori: 'A. PERSIAPAN PELAKSANAAN BIMBINGAN KLASIKAL', aspek: 'Terjadwal masuk kelas secara rutin', id: 'klasikal_2' },
            { kategori: 'A. PERSIAPAN PELAKSANAAN BIMBINGAN KLASIKAL', aspek: 'Memiliki data siswa yang menjadi ampuannya', id: 'klasikal_3' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Menyusun RPL bimbingan klasikal/kelompok untuk masing-masing bidang (pribadi, belajar, sosial dan karier) dan memuat fungsi layanan', id: 'klasikal_4' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Topik dan tujuan layanan dirumuskan dengan kalimat operasional', id: 'klasikal_5' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Memuat dengan jelas sasaran dan waktu pelaksanaan layanan', id: 'klasikal_6' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Merumuskan metode dan teknik yang akan digunakan untuk menyajikan materi bimbingan klasikal', id: 'klasikal_7' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Memilih media sesuai dengan karakteristik sasaran layanan', id: 'klasikal_8' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Menguraikan tahapan kegiatan dalam penyelenggaraan kegiatan, setidaknya memuat tahapan awal, tahap inti dan terminasi/penutupan', id: 'klasikal_9' },
            { kategori: 'RENCANA PELAKSANAAN LAYANAN (RPL)', aspek: 'Memuat jenis evaluasi yang akan dilaksanakan, baik evaluasi proses maupun evaluasi hasil.', id: 'klasikal_10' },
            { kategori: 'B. PELAKSANAAN - Tahapan awal', aspek: 'Keterampilan dalam membentuk hubungan dan memotivasi (contoh: memeriksa kesiapan, mengapresiasi kehadiran dan memberi perhatian bagi siswa yang tidak hadir)', id: 'klasikal_11' },
            { kategori: 'B. PELAKSANAAN - Tahapan awal', aspek: 'Menyampaikan tujuan yang akan dicapai dan langkah-langkah kegiatan', id: 'klasikal_12' },
            { kategori: 'B. PELAKSANAAN - Tahapan awal', aspek: 'Memberikan pengantar materi', id: 'klasikal_13' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Kemampuan dalam menerapkan metode dan teknik dalam menyajikan topik bimbingan', id: 'klasikal_14' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Keterampilan dalam menggunakan media', id: 'klasikal_15' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Metode dan media yang digunakan menumbuhkan minat dan keaktifan siswa', id: 'klasikal_16' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Kemampuan dalam mengelola kelas termasuk memberikan perhatian bagi siswa yang kesulitan', id: 'klasikal_17' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Memberikan kesempatan untuk bertanya', id: 'klasikal_18' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Memberikan respon dan tanggapan secara tepat', id: 'klasikal_19' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Mengelola waktu dengan baik', id: 'klasikal_20' },
            { kategori: 'Tahap Inti/Kerja', aspek: 'Melakukan pengamatan keaktifan siswa sebagai dasar melakukan evaluasi proses layanan', id: 'klasikal_21' },
            { kategori: 'Tahap Akhir/Terminasi', aspek: 'Kemampuan untuk mengajak siswa merefleksikan pengalaman (bisa menjadi dasar evaluasi hasil)', id: 'klasikal_22' },
            { kategori: 'Tahap Akhir/Terminasi', aspek: 'Menyimpulkan hasil pertemuan secara efektif dan menutup pertemuan dengan simpatik (framming)', id: 'klasikal_23' },
        ];
        
        const instrumenAdministrasi = [
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Angket Kebutuhan Peserta Didik', id: 'admin_new_1' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Data Analisis Kebutuhan Siswa', id: 'admin_new_2' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Program Layanan BK', id: 'admin_new_3' },
            { kategori: 'Dokumen Wajib', komponen: 'Kalender Pendidikan dan analisis minggu efektif', id: 'admin_new_4' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Jadwal Layanan BK', id: 'admin_new_5' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Standar Kompetensi Kemandirian Peserta Didik.', id: 'admin_new_6' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Rencana Persiapan Layanan (RPL)', id: 'admin_new_7' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Kumpulan Materi Layanan BK', id: 'admin_new_8' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Kolaborasi', id: 'admin_new_9' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Agenda Guru / Jurnal Layanan Bimbingan', id: 'admin_new_10' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Buku Catatan Konseling', id: 'admin_new_11' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Home Visit', id: 'admin_new_12' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki Dokumen Evaluasi Layanan BK', id: 'admin_new_13' },
            { kategori: 'Dokumen Wajib', komponen: 'Memiliki dokumen tindak lanjut layanan BK', id: 'admin_new_14' },
            { kategori: 'Dokumen Penunjang', komponen: 'Memiliki daftar hadir peserta didik', id: 'admin_new_15' },
            { kategori: 'Dokumen Penunjang', komponen: 'Melakukan Pengembangan Keprofesian Berkelanjutan', id: 'admin_new_16' }
        ];

        let currentTab = 'klasikal';
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let signatureData = null;

        // Initialize Application
        function initApp() {
            renderForms();
            setCurrentDate();
            updateSignatureDisplay();
            initSignatureCanvas();
        }

        // Initialize Signature Canvas
        function initSignatureCanvas() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Event listeners for drawing
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile devices
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const canvas = document.getElementById('signatureCanvas');
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            lastX = currentX;
            lastY = currentY;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            startDrawing(mouseEvent);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            draw(mouseEvent);
        }

        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            signatureData = null;
            
            const preview = document.getElementById('signaturePreview');
            preview.innerHTML = '<span class="text-gray-400 text-sm">Pratinjau tanda tangan akan muncul di sini</span>';
        }

        function saveSignature() {
            const canvas = document.getElementById('signatureCanvas');
            signatureData = canvas.toDataURL('image/png');
            
            const preview = document.getElementById('signaturePreview');
            preview.innerHTML = `<img src="${signatureData}" alt="Tanda Tangan Supervisor">`;
            
            alert('Tanda tangan berhasil disimpan!');
        }

        // Set current date for signature
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('signatureDate').value = formattedDate;
        }

        // Update signature display with current data
        function updateSignatureDisplay() {
            const supervisorName = document.getElementById('nama_supervisor').value;
            const supervisorNip = document.getElementById('nip_supervisor').value;
            const guruName = document.getElementById('nama_guru').value;
            const guruNip = document.getElementById('nip').value;

            document.getElementById('supervisorNameDisplay').textContent = supervisorName || '........................................';
            document.getElementById('supervisorNipDisplay').textContent = `NIP. ${supervisorNip || '.............................'}`;
            document.getElementById('teacherNameDisplay').textContent = guruName || '........................................';
            document.getElementById('teacherNipDisplay').textContent = `NIP. ${guruNip || '.............................'}`;
        }

        // Render Forms
        function renderForms() {
            renderKlasikalForm();
            renderAdministrasiForm();
        }

        function renderKlasikalForm() {
            const container = document.getElementById('instrumen-klasikal-container');
            const printContainer = document.getElementById('instrumen-klasikal-print');
            container.innerHTML = '';
            printContainer.innerHTML = '';
            let currentKategori = '';
            
            instrumenKlasikal.forEach((item, index) => {
                // Tampilan desktop
                const row = document.createElement('tr');
                
                // Jika kategori berubah, buat row dengan kategori
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                row.innerHTML = `
                    <td class="text-center font-medium">${index + 1}</td>
                    <td class="text-gray-700">${item.kategori !== currentKategori ? item.kategori : ''}</td>
                    <td class="text-gray-700">${item.aspek}</td>
                    <td>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="${item.id}_0" name="${item.id}" value="0" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_0" class="text-sm">0 (Tidak Sesuai)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="${item.id}_1" name="${item.id}" value="1" class="h-4 w-4 text-blue-600">
                                <label for="${item.id}_1" class="text-sm">1 (Sesuai Sebagian)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="${item.id}_2" name="${item.id}" value="2" class="h-4 w-4 text-blue-600" checked>
                                <label for="${item.id}_2" class="text-sm">2 (Sesuai Semua)</label>
                            </div>
                        </div>
                        <textarea id="catatan_${item.id}" placeholder="Catatan..." class="score-input" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
                
                // Tampilan print
                const printRow = document.createElement('tr');
                
                // Jika kategori berubah, buat row dengan kategori
                if (item.kategori !== currentKategori) {
                    const printKategoriRow = document.createElement('tr');
                    printKategoriRow.className = 'category-row';
                    printKategoriRow.innerHTML = `<td colspan="5" class="py-1 px-2">${currentKategori}</td>`;
                    printContainer.appendChild(printKategoriRow);
                }
                
                printRow.innerHTML = `
                    <td class="text-center">${index + 1}</td>
                    <td>${item.kategori !== currentKategori ? item.kategori : ''}</td>
                    <td>${item.aspek}</td>
                    <td class="text-center" id="print_${item.id}">2</td>
                    <td id="print_catatan_${item.id}"></td>
                `;
                printContainer.appendChild(printRow);
            });
        }

        function renderAdministrasiForm() {
            const container = document.getElementById('instrumen-administrasi-container');
            const printContainer = document.getElementById('instrumen-administrasi-print');
            container.innerHTML = '';
            printContainer.innerHTML = '';
            let currentKategori = '';
            
            instrumenAdministrasi.forEach((item, index) => {
                // Tampilan desktop
                const row = document.createElement('tr');
                
                // Jika kategori berubah, buat row dengan kategori
                if (item.kategori !== currentKategori) {
                    currentKategori = item.kategori;
                    const kategoriRow = document.createElement('tr');
                    kategoriRow.className = 'category-row';
                    kategoriRow.innerHTML = `<td colspan="4" class="py-2 px-3">${currentKategori}</td>`;
                    container.appendChild(kategoriRow);
                }
                
                row.innerHTML = `
                    <td class="text-center font-medium">${index + 1}</td>
                    <td class="text-gray-700">${item.kategori !== currentKategori ? item.kategori : ''}</td>
                    <td class="text-gray-700">${item.komponen}</td>
                    <td>
                        <div class="flex flex-wrap items-center gap-3 mb-2">
                            ${[0,1,2,3,4].map(val => `
                                <div class="flex items-center">
                                    <input type="radio" id="${item.id}_${val}" name="${item.id}" value="${val}" class="h-4 w-4 text-blue-600" ${val === 4 ? 'checked' : ''}>
                                    <label for="${item.id}_${val}" class="ml-1 text-sm">${val}</label>
                                </div>
                            `).join('')}
                        </div>
                        <textarea id="keterangan_${item.id}" placeholder="Keterangan..." class="score-input" rows="2"></textarea>
                    </td>
                `;
                container.appendChild(row);
                
                // Tampilan print
                const printRow = document.createElement('tr');
                
                // Jika kategori berubah, buat row dengan kategori
                if (item.kategori !== currentKategori) {
                    const printKategoriRow = document.createElement('tr');
                    printKategoriRow.className = 'category-row';
                    printKategoriRow.innerHTML = `<td colspan="5" class="py-1 px-2">${currentKategori}</td>`;
                    printContainer.appendChild(printKategoriRow);
                }
                
                printRow.innerHTML = `
                    <td class="text-center">${index + 1}</td>
                    <td>${item.kategori !== currentKategori ? item.kategori : ''}</td>
                    <td>${item.komponen}</td>
                    <td class="text-center" id="print_${item.id}">4</td>
                    <td id="print_keterangan_${item.id}"></td>
                `;
                printContainer.appendChild(printRow);
            });
        }

        // Tab Management
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.getElementById('tab-klasikal-btn').classList.toggle('active', tabName === 'klasikal');
            document.getElementById('tab-administrasi-btn').classList.toggle('active', tabName === 'administrasi');
            
            // Update content visibility
            document.getElementById('tab-klasikal-content').classList.toggle('hidden', tabName !== 'klasikal');
            document.getElementById('tab-administrasi-content').classList.toggle('hidden', tabName !== 'administrasi');
            
            // Update info sections
            document.getElementById('info-klasikal').classList.toggle('hidden', tabName !== 'klasikal');
            document.getElementById('info-administrasi').classList.toggle('hidden', tabName !== 'administrasi');
            
            document.getElementById('hasil-penilaian').classList.add('hidden');
        }

        // Validation and Calculation
        function validateAndCalculate() {
            const requiredFields = getRequiredFields();
            let isValid = true;
            let errors = [];

            // Validasi tanda tangan digital
            if (!signatureData) {
                alert('Mohon buat dan simpan tanda tangan digital terlebih dahulu!');
                return;
            }

            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element || element.value.trim() === '') {
                    isValid = false;
                    errors.push(field.id);
                    element.classList.add('border-red-500');
                } else {
                    element.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                alert('Mohon lengkapi semua field yang wajib diisi!');
                return;
            }

            calculateScores();
        }

        function calculateScores() {
            let totalScore = 0;
            let maxScore = 0;
            let items = [];

            if (currentTab === 'klasikal') {
                items = instrumenKlasikal;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        const scoreValue = parseInt(score.value);
                        totalScore += scoreValue;
                        // Update nilai di tabel print
                        document.getElementById(`print_${item.id}`).textContent = scoreValue;
                        document.getElementById(`print_catatan_${item.id}`).textContent = 
                            document.getElementById(`catatan_${item.id}`).value;
                    }
                });
                maxScore = items.length * 2;
            } else {
                items = instrumenAdministrasi;
                items.forEach(item => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`);
                    if (score) {
                        const scoreValue = parseInt(score.value);
                        totalScore += scoreValue;
                        // Update nilai di tabel print
                        document.getElementById(`print_${item.id}`).textContent = scoreValue;
                        document.getElementById(`print_keterangan_${item.id}`).textContent = 
                            document.getElementById(`keterangan_${item.id}`).value;
                    }
                });
                maxScore = items.length * 4;
            }

            const percentage = maxScore > 0 ? ((totalScore / maxScore) * 100).toFixed(currentTab === 'klasikal' ? 2 : 0) : 0;
            const grade = calculateGrade(percentage);

            // Update results
            document.getElementById('skor_total').textContent = totalScore;
            document.getElementById('skor_maksimal').textContent = maxScore;
            document.getElementById('nilai_akhir').textContent = `${percentage}%`;
            document.getElementById('keterangan_nilai').textContent = grade;
            document.getElementById('peringkat-label').textContent = currentTab === 'klasikal' ? 'Keterangan' : 'Peringkat';

            // Update signature section
            updateSignatureDisplay();

            // Show results
            document.getElementById('hasil-penilaian').classList.remove('hidden');
        }

        function calculateGrade(percentage) {
            if (currentTab === 'klasikal') {
                if (percentage >= 91) return 'Sangat Baik';
                if (percentage >= 76) return 'Baik';
                if (percentage >= 61) return 'Cukup';
                return 'Kurang';
            } else {
                if (percentage > 90) return 'Amat Baik (AB)';
                if (percentage > 80) return 'Baik (B)';
                if (percentage > 70) return 'Cukup (C)';
                return 'Kurang (K)';
            }
        }

        function getRequiredFields() {
            const baseFields = [
                { id: 'nama_supervisor' }, { id: 'nip_supervisor' },
                { id: 'nama_guru' }, { id: 'nip' }
            ];

            if (currentTab === 'klasikal') {
                return [...baseFields,
                    { id: 'kelas_semester' }, { id: 'tanggal' },
                    { id: 'kesimpulan_klasikal' }, { id: 'refleksi_klasikal' }, { id: 'rekomendasi_klasikal' }
                ];
            } else {
                return [...baseFields,
                    { id: 'tahun_pelajaran' }, { id: 'semester' },
                    { id: 'komentar_admin' }
                ];
            }
        }

        // Export to CSV
        function exportToCSV() {
            validateAndCalculate();
            
            let csv = "SUPERVISI GURU BK - SMKN 1 PURBALINGGA\n";
            csv += `Supervisor,${document.getElementById('nama_supervisor').value}\n`;
            csv += `NIP Supervisor,${document.getElementById('nip_supervisor').value}\n`;
            csv += `Guru BK,${document.getElementById('nama_guru').value}\n`;
            csv += `NIP Guru BK,${document.getElementById('nip').value}\n`;
            csv += `Tanggal Validasi,${document.getElementById('signatureDate').value}\n\n`;

            if (currentTab === 'klasikal') {
                csv += `Tipe Supervisi,Bimbingan Klasikal\n`;
                csv += `Kelas/Semester,${document.getElementById('kelas_semester').value}\n`;
                csv += `Hari Tanggal,${document.getElementById('tanggal').value}\n\n`;
                csv += "No,Kategori,Aspek Penilaian,Skor,Catatan\n";
                instrumenKlasikal.forEach((item, index) => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`)?.value || '0';
                    const catatan = document.getElementById(`catatan_${item.id}`).value;
                    csv += `${index + 1},"${item.kategori}","${item.aspek}",${score},"${catatan}"\n`;
                });
            } else {
                csv += `Tipe Supervisi,Administrasi BK\n`;
                csv += `Tahun Pelajaran,${document.getElementById('tahun_pelajaran').value}\n`;
                csv += `Semester,${document.getElementById('semester').value}\n\n`;
                csv += "No,Kategori,Komponen Administrasi,Skor,Keterangan\n";
                instrumenAdministrasi.forEach((item, index) => {
                    const score = document.querySelector(`input[name="${item.id}"]:checked`)?.value || '0';
                    const keterangan = document.getElementById(`keterangan_${item.id}`).value;
                    csv += `${index + 1},"${item.kategori}","${item.komponen}",${score},"${keterangan}"\n`;
                });
            }

            // Add results
            csv += `\nSkor Total,${document.getElementById('skor_total').textContent}\n`;
            csv += `Skor Maksimal,${document.getElementById('skor_maksimal').textContent}\n`;
            csv += `Nilai Akhir,${document.getElementById('nilai_akhir').textContent}\n`;
            csv += `Peringkat,${document.getElementById('keterangan_nilai').textContent}\n`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `supervisi_bk_${document.getElementById('nama_guru').value.replace(/\s+/g, '_')}_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Reset Form
        function resetForm() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                document.getElementById('nama_supervisor').value = 'Maryono, S.Pd., M.Si';
                document.getElementById('nip_supervisor').value = '196607012000121002';
                document.getElementById('nama_guru').value = '';
                document.getElementById('nip').value = '';
                document.getElementById('kelas_semester').value = '';
                document.getElementById('tanggal').value = '';
                document.getElementById('tahun_pelajaran').value = '2024/2025';
                document.getElementById('semester').value = 'Ganjil';
                document.getElementById('kesimpulan_klasikal').value = '';
                document.getElementById('refleksi_klasikal').value = '';
                document.getElementById('rekomendasi_klasikal').value = '';
                document.getElementById('komentar_admin').value = '';

                // Reset radio buttons
                const items = currentTab === 'klasikal' ? instrumenKlasikal : instrumenAdministrasi;
                items.forEach(item => {
                    const defaultValue = currentTab === 'klasikal' ? '2' : '4';
                    document.getElementById(`${item.id}_${defaultValue}`).checked = true;
                    const textarea = document.getElementById(`${currentTab === 'klasikal' ? 'catatan' : 'keterangan'}_${item.id}`);
                    if (textarea) textarea.value = '';
                });

                // Reset signature
                clearSignature();

                document.getElementById('hasil-penilaian').classList.add('hidden');
                setCurrentDate();
                updateSignatureDisplay();
                
                alert('Form telah direset!');
            }
        }

        // Initialize when page loads
        window.onload = initApp;
    </script>
</body>
</html>
